{
  "openapi": "3.1.0",
  "info": {
    "title": "Arke v1 API",
    "version": "1.0.0",
    "description": "Entity management API with content-addressed versioning and permissions."
  },
  "servers": [
    {
      "url": "https://arke-v1.arke.institute",
      "description": "Production"
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authentication and registration"
    },
    {
      "name": "Users",
      "description": "User profile management"
    },
    {
      "name": "Collections",
      "description": "Collection and permission management"
    },
    {
      "name": "Entities",
      "description": "Generic entity CRUD"
    },
    {
      "name": "Relationships",
      "description": "Entity relationship management"
    },
    {
      "name": "Files",
      "description": "File storage with versioning"
    },
    {
      "name": "Folders",
      "description": "Folder hierarchy management"
    },
    {
      "name": "Permissions",
      "description": "Permission system metadata and introspection"
    },
    {
      "name": "Agents",
      "description": "Agent management and invocation"
    },
    {
      "name": "Jobs",
      "description": "Job collection status and monitoring"
    },
    {
      "name": "Events",
      "description": "Entity change event stream"
    },
    {
      "name": "Graph",
      "description": "Graph traversal and path-finding"
    },
    {
      "name": "Query",
      "description": "Argo DSL query engine"
    },
    {
      "name": "Search",
      "description": "Cross-collection semantic search"
    },
    {
      "name": "Documentation",
      "description": "API documentation and introspection"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Supabase JWT token"
      },
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "API Key authentication. Format: `ApiKey ak_xxx` (agent) or `ApiKey uk_xxx` (user)"
      }
    },
    "parameters": {
      "X-Arke-Network": {
        "name": "X-Arke-Network",
        "in": "header",
        "required": false,
        "schema": {
          "type": "string",
          "enum": [
            "main",
            "test"
          ],
          "default": "main"
        },
        "description": "Target network. Use `test` for isolated test data with II-prefixed IDs."
      },
      "X-On-Behalf-Of": {
        "name": "X-On-Behalf-Of",
        "in": "header",
        "required": false,
        "schema": {
          "type": "string"
        },
        "description": "User entity ID for service accounts acting on behalf of a user. Only valid with `role: service` authentication."
      }
    },
    "schemas": {
      "RegisterUser": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "example": "01J1SHMAE10000000000000000"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "example": {
              "label": "Ishmael",
              "name": "Ishmael"
            }
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          }
        },
        "required": [
          "id",
          "cid",
          "properties",
          "ver"
        ]
      },
      "RegisterResponse": {
        "type": "object",
        "properties": {
          "created": {
            "type": "boolean",
            "description": "True if user was created, false if already registered",
            "example": true
          },
          "user": {
            "$ref": "#/components/schemas/RegisterUser"
          }
        },
        "required": [
          "created",
          "user"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Error message",
            "example": "Not found"
          },
          "details": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Additional error details"
          }
        },
        "required": [
          "error"
        ]
      },
      "EntityResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "type": {
            "type": "string",
            "example": "collection"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "example": {
              "label": "The Pequod's Archive",
              "description": "A collection of whaling documents"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            }
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "ts": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Unix timestamp in milliseconds",
            "example": 1735214400000
          },
          "edited_by": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "minLength": 1
              },
              "method": {
                "type": "string",
                "enum": [
                  "manual",
                  "ai_generated",
                  "system",
                  "import"
                ]
              },
              "on_behalf_of": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "method"
            ],
            "description": "Audit trail for edits",
            "example": {
              "user_id": "01JCAPTAINAHAB000000000000",
              "method": "manual"
            }
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Previous version CID (present on updates)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "id",
          "cid",
          "type",
          "properties",
          "relationships",
          "ver",
          "created_at",
          "ts",
          "edited_by"
        ]
      },
      "UserResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "user"
                ]
              }
            }
          }
        ]
      },
      "UserUpdateResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/UserResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "ValidationErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Validation failed"
          },
          "details": {
            "type": "object",
            "properties": {
              "issues": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "array",
                      "items": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "number"
                          }
                        ]
                      }
                    },
                    "message": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "path",
                    "message"
                  ]
                }
              }
            },
            "required": [
              "issues"
            ]
          }
        },
        "required": [
          "error"
        ]
      },
      "CASErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "enum": [
              "Conflict: entity was modified"
            ]
          },
          "details": {
            "type": "object",
            "properties": {
              "expected": {
                "type": "string",
                "description": "Expected tip CID"
              },
              "actual": {
                "type": "string",
                "description": "Actual current tip CID"
              }
            },
            "required": [
              "expected",
              "actual"
            ]
          }
        },
        "required": [
          "error",
          "details"
        ]
      },
      "UserUpdateRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "description": "Updated display name",
            "example": "Captain Ahab"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "CreateApiKeyResponse": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string",
            "description": "Full API key - store this securely, it will not be shown again",
            "example": "uk_xKj92mNpQrStUvWxYz1234567890abcdef1234567890abcdef12345678"
          },
          "key_prefix": {
            "type": "string",
            "description": "Key prefix for identification",
            "example": "uk_xKj9"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the key expires",
            "example": "2026-03-28T00:00:00.000Z"
          }
        },
        "required": [
          "key",
          "key_prefix",
          "expires_at"
        ]
      },
      "CreateApiKeyRequest": {
        "type": "object",
        "properties": {
          "label": {
            "type": "string",
            "maxLength": 100,
            "description": "Human-readable label for the key",
            "example": "Production"
          },
          "expires_in": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "maximum": 31536000,
            "description": "Time until expiration in seconds (default: 90 days, max: 365 days)",
            "example": 7776000
          }
        }
      },
      "ApiKeyInfo": {
        "type": "object",
        "properties": {
          "key_prefix": {
            "type": "string",
            "description": "Key prefix for identification",
            "example": "uk_xKj9"
          },
          "label": {
            "type": "string",
            "nullable": true,
            "description": "Human-readable label",
            "example": "Production"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the key was created",
            "example": "2025-12-28T00:00:00.000Z"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the key expires",
            "example": "2026-03-28T00:00:00.000Z"
          },
          "last_used_at": {
            "type": "string",
            "nullable": true,
            "format": "date-time",
            "description": "When the key was last used (null if never used)",
            "example": "2025-12-28T10:30:00.000Z"
          }
        },
        "required": [
          "key_prefix",
          "label",
          "created_at",
          "expires_at",
          "last_used_at"
        ]
      },
      "ListApiKeysResponse": {
        "type": "object",
        "properties": {
          "keys": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ApiKeyInfo"
            },
            "description": "List of API keys"
          }
        },
        "required": [
          "keys"
        ]
      },
      "UserCollectionItem": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "description": "Collection persistent identifier",
            "example": "01JCOLLECTION123456789AB"
          },
          "label": {
            "type": "string",
            "description": "Collection label/name",
            "example": "My Research Collection"
          },
          "predicate": {
            "type": "string",
            "description": "Role predicate indicating user's relationship to collection",
            "example": "owner"
          },
          "created_at": {
            "type": "string",
            "description": "When the collection was created",
            "example": "2026-01-12T00:00:00.000Z"
          }
        },
        "required": [
          "pi",
          "label",
          "predicate",
          "created_at"
        ]
      },
      "UserCollectionsResponse": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "User persistent identifier",
            "example": "01JUSER123456789ABCDEFGH"
          },
          "collections": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UserCollectionItem"
            },
            "description": "Collections the user has access to"
          },
          "pagination": {
            "type": "object",
            "properties": {
              "offset": {
                "type": "number",
                "description": "Current offset"
              },
              "limit": {
                "type": "number",
                "description": "Results per page"
              },
              "count": {
                "type": "number",
                "description": "Number of results returned"
              },
              "has_more": {
                "type": "boolean",
                "description": "Whether more results exist"
              }
            },
            "required": [
              "offset",
              "limit",
              "count",
              "has_more"
            ],
            "description": "Pagination metadata"
          }
        },
        "required": [
          "user_id",
          "collections",
          "pagination"
        ]
      },
      "SearchResultItem": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity persistent identifier",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string",
            "description": "Entity type",
            "example": "file"
          },
          "label": {
            "type": "string",
            "description": "Entity label/name",
            "example": "Research Paper.pdf"
          },
          "collection_pi": {
            "type": "string",
            "nullable": true,
            "description": "Collection this entity belongs to (null for public-domain)",
            "example": "01JCOLLECTION123456789AB"
          },
          "score": {
            "type": "number",
            "description": "Relevance score (0-1, higher is better)",
            "example": 0.87
          },
          "created_at": {
            "type": "string",
            "description": "When the entity was created",
            "example": "2026-01-12T00:00:00.000Z"
          },
          "updated_at": {
            "type": "string",
            "description": "When the entity was last updated",
            "example": "2026-01-12T10:30:00.000Z"
          }
        },
        "required": [
          "pi",
          "type",
          "label",
          "collection_pi",
          "score"
        ]
      },
      "SearchMetadata": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Original search query"
          },
          "collections_queried": {
            "type": "integer",
            "description": "Number of collections searched"
          },
          "collections_total": {
            "type": "integer",
            "description": "Total collections user has access to"
          },
          "include_public": {
            "type": "boolean",
            "description": "Whether public-domain was included"
          },
          "execution_time_ms": {
            "type": "number",
            "description": "Total execution time in milliseconds"
          },
          "result_count": {
            "type": "integer",
            "description": "Number of results returned"
          }
        },
        "required": [
          "query",
          "collections_queried",
          "collections_total",
          "include_public",
          "execution_time_ms",
          "result_count"
        ],
        "description": "Search metadata and statistics"
      },
      "CrossCollectionSearchResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SearchResultItem"
            },
            "description": "Search results ranked by relevance"
          },
          "metadata": {
            "$ref": "#/components/schemas/SearchMetadata"
          }
        },
        "required": [
          "results",
          "metadata"
        ]
      },
      "CrossCollectionSearchRequest": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "minLength": 1,
            "maxLength": 500,
            "description": "Search query text for semantic matching",
            "example": "medical research"
          },
          "type": {
            "type": "string",
            "description": "Filter results to specific entity type",
            "example": "file"
          },
          "role": {
            "type": "string",
            "enum": [
              "owner",
              "editor",
              "viewer"
            ],
            "description": "Filter collections by user role (only search collections where user has this role)",
            "example": "owner"
          },
          "include_public": {
            "type": "boolean",
            "default": false,
            "description": "Include results from public-domain namespace (default: false)",
            "example": false
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 20,
            "description": "Maximum number of results to return (default: 20, max: 100)",
            "example": 50
          }
        },
        "required": [
          "query"
        ]
      },
      "CollectionResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "collection"
                ]
              }
            }
          }
        ]
      },
      "CreateCollectionRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Custom entity ID (generated if not provided)"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Collection display name",
            "example": "The Pequod's Archive"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "description": "Collection description",
            "example": "Documents and manuscripts related to the voyage of the Pequod"
          },
          "display_image_url": {
            "type": "string",
            "format": "uri",
            "description": "URL for collection display image"
          },
          "roles": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Custom role definitions (defaults to owner/editor/viewer/public)",
            "example": {
              "captain": [
                "*:view",
                "*:update",
                "*:create",
                "collection:manage"
              ],
              "harpooner": [
                "*:view",
                "*:update",
                "*:create"
              ],
              "crew": [
                "*:view",
                "entity:create"
              ],
              "public": [
                "entity:view",
                "collection:view"
              ]
            }
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Additional properties to store"
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Initial relationships"
          }
        },
        "required": [
          "label"
        ]
      },
      "CollectionUpdateResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/CollectionResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateCollectionRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Updated collection display name"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "description": "Updated collection description"
          },
          "display_image_url": {
            "type": "string",
            "format": "uri",
            "description": "Updated display image URL"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "RoleResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "roles": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Role definitions mapping role names to action arrays",
            "example": {
              "captain": [
                "*:view",
                "*:update",
                "*:create",
                "collection:manage"
              ],
              "harpooner": [
                "*:view",
                "*:update",
                "*:create"
              ],
              "crew": [
                "*:view",
                "entity:create"
              ],
              "public": [
                "entity:view",
                "collection:view"
              ]
            }
          }
        },
        "required": [
          "id",
          "cid",
          "prev_cid",
          "ver",
          "roles"
        ]
      },
      "AddRoleRequest": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "description": "Name of the new role",
            "example": "harpooner"
          },
          "actions": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1,
            "description": "Actions this role can perform",
            "example": [
              "entity:view",
              "entity:create",
              "entity:update"
            ]
          }
        },
        "required": [
          "role",
          "actions"
        ]
      },
      "UpdateRoleRequest": {
        "type": "object",
        "properties": {
          "actions": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1,
            "description": "Updated actions for this role",
            "example": [
              "entity:view",
              "entity:create",
              "entity:update",
              "entity:delete"
            ]
          }
        },
        "required": [
          "actions"
        ]
      },
      "CollectionMember": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
          },
          "role": {
            "type": "string"
          },
          "userLabel": {
            "type": "string"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp when this membership expires (omitted for permanent)"
          },
          "granted_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp when this membership was granted"
          },
          "granted_by": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "User who granted this membership"
          },
          "is_expired": {
            "type": "boolean",
            "description": "Whether this membership has expired"
          }
        },
        "required": [
          "userId",
          "role",
          "is_expired"
        ]
      },
      "CollectionGroup": {
        "type": "object",
        "properties": {
          "groupId": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
          },
          "role": {
            "type": "string"
          },
          "groupLabel": {
            "type": "string"
          }
        },
        "required": [
          "groupId",
          "role"
        ]
      },
      "CollectionWildcard": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string"
          }
        },
        "required": [
          "role"
        ]
      },
      "MembersResponse": {
        "type": "object",
        "properties": {
          "collection_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
          },
          "members": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CollectionMember"
            }
          },
          "groups": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CollectionGroup"
            }
          },
          "wildcards": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CollectionWildcard"
            }
          }
        },
        "required": [
          "collection_id",
          "members",
          "groups",
          "wildcards"
        ]
      },
      "MemberAssignResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "member_added": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
              },
              "role": {
                "type": "string"
              },
              "expires_at": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 timestamp when this role expires (omitted for permanent)",
                "example": "2025-01-15T00:00:00.000Z"
              },
              "granted_at": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 timestamp when this role was granted",
                "example": "2025-01-01T12:00:00.000Z"
              },
              "granted_by": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "User who granted this role"
              }
            },
            "required": [
              "user_id",
              "role",
              "granted_at",
              "granted_by"
            ]
          }
        },
        "required": [
          "id",
          "cid",
          "prev_cid",
          "ver",
          "member_added"
        ]
      },
      "AssignRoleRequest": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "User entity ID to assign the role to",
            "example": "01JQ3EQ3EG000000000000000"
          },
          "role": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "description": "Role name to assign",
            "example": "harpooner"
          },
          "expires_in": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Seconds until this role assignment expires (omit for permanent access)",
            "example": 86400
          }
        },
        "required": [
          "user_id",
          "role"
        ]
      },
      "MemberRemoveResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "member_removed": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
              },
              "role": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "role"
            ]
          }
        },
        "required": [
          "id",
          "cid",
          "prev_cid",
          "ver",
          "member_removed"
        ]
      },
      "SetRootEntityResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/CollectionUpdateResponse"
          },
          {
            "type": "object",
            "properties": {
              "root_entity_id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "ID of the entity that was set as root"
              }
            },
            "required": [
              "root_entity_id"
            ]
          }
        ]
      },
      "SetRootEntityRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "entity_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID to set as the root of this collection. Entity must already have a collection relationship pointing to this collection.",
            "example": "01JQ3EQ3EG000000000000000"
          }
        },
        "required": [
          "expect_tip",
          "entity_id"
        ]
      },
      "CollectionEntitySummary": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity persistent identifier"
          },
          "type": {
            "type": "string",
            "description": "Entity type",
            "example": "document"
          },
          "label": {
            "type": "string",
            "description": "Entity display label",
            "example": "My Document"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the entity was created"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the entity was last updated"
          }
        },
        "required": [
          "pi",
          "type",
          "label",
          "created_at",
          "updated_at"
        ]
      },
      "CollectionEntitiesResponse": {
        "type": "object",
        "properties": {
          "collection_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection ID"
          },
          "entities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CollectionEntitySummary"
            },
            "description": "Entities in this collection"
          },
          "pagination": {
            "type": "object",
            "properties": {
              "offset": {
                "type": "integer",
                "description": "Current offset"
              },
              "limit": {
                "type": "integer",
                "description": "Requested limit"
              },
              "count": {
                "type": "integer",
                "description": "Number of entities returned"
              },
              "has_more": {
                "type": "boolean",
                "description": "Whether more entities exist beyond this page"
              }
            },
            "required": [
              "offset",
              "limit",
              "count",
              "has_more"
            ],
            "description": "Pagination info"
          }
        },
        "required": [
          "collection_id",
          "entities",
          "pagination"
        ]
      },
      "EntityCreatedResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "type": {
            "type": "string",
            "example": "collection"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "example": {
              "label": "The Pequod's Archive",
              "description": "A collection of whaling documents"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            }
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "ts": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Unix timestamp in milliseconds",
            "example": 1735214400000
          },
          "edited_by": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "minLength": 1
              },
              "method": {
                "type": "string",
                "enum": [
                  "manual",
                  "ai_generated",
                  "system",
                  "import"
                ]
              },
              "on_behalf_of": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "method"
            ],
            "description": "Audit trail for edits",
            "example": {
              "user_id": "01JCAPTAINAHAB000000000000",
              "method": "manual"
            }
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Previous version CID (present on updates)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "id",
          "cid",
          "type",
          "properties",
          "relationships",
          "ver",
          "created_at",
          "ts",
          "edited_by"
        ]
      },
      "CreateEntityRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Custom entity ID (generated if not provided)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Entity type identifier",
            "example": "document"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Entity properties (type-specific). Text properties may contain inline entity references using the arke: URI scheme (e.g., [Label](arke:01JENTITY123...)) for domain-agnostic linking.",
            "example": {
              "label": "Chapter 1: Loomings",
              "author": "Herman Melville"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Entity relationships"
          },
          "collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Parent collection ID (creates collection relationship)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          }
        },
        "required": [
          "type"
        ]
      },
      "EntityPreview": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Entity ID (persistent identifier)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string",
            "description": "Entity type",
            "example": "document"
          },
          "label": {
            "type": "string",
            "description": "Entity label (from properties.label, filename, or name)",
            "example": "Research Paper.pdf"
          },
          "collection_pi": {
            "type": "string",
            "description": "Collection ID this entity belongs to",
            "example": "01JCOLLECTION123456789ABCD"
          },
          "description_preview": {
            "type": "string",
            "description": "Truncated description (max 200 chars + \"...\")",
            "example": "This document contains research findings from the 2025 study on entity management systems. It covers key architectural decisions and performance benchmarks..."
          },
          "text_preview": {
            "type": "string",
            "description": "Truncated text content (max 200 chars + \"...\")",
            "example": "Introduction: The rise of decentralized entity management systems has created new challenges for data integrity and consistency. This paper explores..."
          },
          "created_at": {
            "type": "string",
            "description": "Entity creation timestamp (ISO 8601)",
            "example": "2025-01-15T10:00:00.000Z"
          },
          "updated_at": {
            "type": "string",
            "description": "Last update timestamp (ISO 8601)",
            "example": "2025-01-20T14:30:00.000Z"
          }
        },
        "required": [
          "id",
          "type",
          "label",
          "created_at",
          "updated_at"
        ]
      },
      "TipResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "id",
          "cid"
        ]
      },
      "EntityUpdatedResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateEntityRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "EntityDeletedResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "deleted_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO timestamp when the entity was deleted"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "prev_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "id",
          "cid",
          "deleted_at",
          "ver",
          "prev_cid"
        ]
      },
      "DeleteEntityRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "reason": {
            "type": "string",
            "maxLength": 500,
            "description": "Reason for deleting the entity",
            "example": "Duplicate entry"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "CascadeDeletedEntity": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "type": {
            "type": "string",
            "description": "Entity type",
            "example": "file"
          },
          "depth": {
            "type": "integer",
            "description": "Depth from root entity at which this entity was found",
            "example": 1
          }
        },
        "required": [
          "id",
          "cid",
          "type",
          "depth"
        ]
      },
      "CascadeSkippedEntity": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string",
            "description": "Entity type",
            "example": "file"
          },
          "reason": {
            "type": "string",
            "enum": [
              "not_in_collection",
              "already_deleted",
              "edited_by_mismatch",
              "cas_conflict"
            ],
            "description": "Reason an entity was skipped during cascade delete"
          }
        },
        "required": [
          "id",
          "type",
          "reason"
        ]
      },
      "CascadeDeleteResponse": {
        "type": "object",
        "properties": {
          "root": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityDeletedResponse"
              },
              {
                "description": "Deletion result for the root entity"
              }
            ]
          },
          "deleted": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CascadeDeletedEntity"
            },
            "description": "Entities successfully deleted (ordered by depth, deepest first)"
          },
          "skipped": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CascadeSkippedEntity"
            },
            "description": "Entities skipped during traversal with reasons"
          },
          "summary": {
            "type": "object",
            "properties": {
              "total_traversed": {
                "type": "integer",
                "description": "Total entities visited during BFS traversal"
              },
              "total_deleted": {
                "type": "integer",
                "description": "Total entities successfully deleted (excluding root)"
              },
              "total_skipped": {
                "type": "integer",
                "description": "Total entities skipped during traversal"
              },
              "max_depth_reached": {
                "type": "integer",
                "description": "Maximum depth reached during traversal"
              }
            },
            "required": [
              "total_traversed",
              "total_deleted",
              "total_skipped",
              "max_depth_reached"
            ],
            "description": "Summary statistics for the cascade delete operation"
          }
        },
        "required": [
          "root",
          "deleted",
          "skipped",
          "summary"
        ]
      },
      "CascadeDeleteRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "collection_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection to scope the cascade delete. Only entities in this collection will be deleted. Permission check is performed on this collection.",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cascade_predicates": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1,
            "description": "Predicate patterns to follow during cascade traversal. Supports wildcards:\n- `\"child\"` - exact match only\n- `\"has_*\"` - matches has_document, has_image, etc.\n- `\"*_copy\"` - matches file_copy, document_copy, etc.\n- `\"*\"` - matches ALL predicates\n\n**Important:** The `collection` predicate NEVER cascades, even if `\"*\"` is specified. This protects the collection structure from accidental deletion.",
            "example": [
              "child",
              "has_*"
            ]
          },
          "edited_by_filter": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Only delete entities where edited_by.user_id matches this PI. Useful for cleaning up entities created by a specific agent.",
            "example": "01KAGENTXXXXXXXXXXXXXXXX"
          },
          "max_depth": {
            "type": "integer",
            "minimum": 1,
            "maximum": 20,
            "default": 10,
            "description": "Maximum relationship depth to traverse (default: 10, max: 20)",
            "example": 10
          },
          "reason": {
            "type": "string",
            "maxLength": 500,
            "description": "Reason for deleting the entities (applied to all deleted entities)",
            "example": "Cleanup after agent task"
          }
        },
        "required": [
          "expect_tip",
          "collection_id",
          "cascade_predicates"
        ]
      },
      "EntityUpdateResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "EntityRestoredResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityUpdateResponse"
          },
          {
            "type": "object",
            "properties": {
              "restored_from_ver": {
                "type": "integer",
                "minimum": 0,
                "exclusiveMinimum": true,
                "description": "The version number that was restored from",
                "example": 1
              }
            },
            "required": [
              "restored_from_ver"
            ]
          }
        ]
      },
      "RestoreEntityRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "EntityCollectionResponse": {
        "type": "object",
        "properties": {
          "collection_id": {
            "type": "string",
            "nullable": true,
            "description": "The collection ID this entity belongs to, or null if not in any collection",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          }
        },
        "required": [
          "collection_id"
        ]
      },
      "TreeNode": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "label": {
            "type": "string",
            "description": "Entity label"
          },
          "type": {
            "type": "string",
            "description": "Entity type"
          },
          "depth": {
            "type": "integer",
            "description": "Depth in tree (0 = root)"
          },
          "children": {
            "type": "array",
            "description": "Child nodes (recursive TreeNode array)",
            "items": {
              "$ref": "#/components/schemas/TreeNode"
            }
          }
        },
        "required": [
          "pi",
          "label",
          "type",
          "depth",
          "children"
        ],
        "description": "Root node with nested children"
      },
      "TreeResponse": {
        "type": "object",
        "properties": {
          "root": {
            "$ref": "#/components/schemas/TreeNode"
          },
          "total_nodes": {
            "type": "integer",
            "description": "Total number of nodes in the tree"
          },
          "truncated": {
            "type": "boolean",
            "description": "Whether results were truncated due to limit"
          }
        },
        "required": [
          "root",
          "total_nodes",
          "truncated"
        ]
      },
      "VersionMeta": {
        "type": "object",
        "nullable": true,
        "properties": {
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "ts": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          }
        },
        "required": [
          "cid",
          "ver",
          "ts"
        ],
        "description": "Metadata about the \"from\" version (null for version 1)"
      },
      "PropertyChange": {
        "type": "object",
        "properties": {
          "from": {
            "nullable": true,
            "description": "Previous value"
          },
          "to": {
            "nullable": true,
            "description": "New value"
          }
        }
      },
      "PropertiesChanges": {
        "type": "object",
        "properties": {
          "added": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties that were added",
            "example": {
              "email": "new@example.com"
            }
          },
          "removed": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties that were removed (includes old values)",
            "example": {
              "deprecated_field": "old value"
            }
          },
          "changed": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/PropertyChange"
            },
            "description": "Properties that changed",
            "example": {
              "name": {
                "from": "Old Name",
                "to": "New Name"
              }
            }
          }
        },
        "required": [
          "added",
          "removed",
          "changed"
        ]
      },
      "RelationshipChange": {
        "type": "object",
        "properties": {
          "predicate": {
            "type": "string",
            "minLength": 1
          },
          "peer": {
            "type": "string",
            "minLength": 1
          },
          "peer_type": {
            "type": "string"
          },
          "peer_label": {
            "type": "string"
          },
          "properties": {
            "$ref": "#/components/schemas/PropertyChange"
          }
        },
        "required": [
          "predicate",
          "peer",
          "properties"
        ]
      },
      "RelationshipsChanges": {
        "type": "object",
        "properties": {
          "added": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Relationships that were added"
          },
          "removed": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Relationships that were removed"
          },
          "changed": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RelationshipChange"
            },
            "description": "Relationships with changed properties"
          }
        },
        "required": [
          "added",
          "removed",
          "changed"
        ]
      },
      "SemanticChanges": {
        "type": "object",
        "properties": {
          "properties": {
            "$ref": "#/components/schemas/PropertiesChanges"
          },
          "relationships": {
            "$ref": "#/components/schemas/RelationshipsChanges"
          }
        },
        "required": [
          "properties",
          "relationships"
        ]
      },
      "SemanticDiffResponse": {
        "type": "object",
        "properties": {
          "entity_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "from": {
            "$ref": "#/components/schemas/VersionMeta"
          },
          "to": {
            "$ref": "#/components/schemas/VersionMeta"
          },
          "format": {
            "type": "string",
            "enum": [
              "semantic"
            ]
          },
          "changes": {
            "$ref": "#/components/schemas/SemanticChanges"
          }
        },
        "required": [
          "entity_id",
          "from",
          "to",
          "format",
          "changes"
        ]
      },
      "PatchOperation": {
        "anyOf": [
          {
            "type": "object",
            "properties": {
              "op": {
                "type": "string",
                "enum": [
                  "add"
                ]
              },
              "path": {
                "type": "string"
              },
              "value": {
                "nullable": true
              }
            },
            "required": [
              "op",
              "path"
            ]
          },
          {
            "type": "object",
            "properties": {
              "op": {
                "type": "string",
                "enum": [
                  "remove"
                ]
              },
              "path": {
                "type": "string"
              }
            },
            "required": [
              "op",
              "path"
            ]
          },
          {
            "type": "object",
            "properties": {
              "op": {
                "type": "string",
                "enum": [
                  "replace"
                ]
              },
              "path": {
                "type": "string"
              },
              "value": {
                "nullable": true
              }
            },
            "required": [
              "op",
              "path"
            ]
          }
        ]
      },
      "PatchDiffResponse": {
        "type": "object",
        "properties": {
          "entity_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "from": {
            "$ref": "#/components/schemas/VersionMeta"
          },
          "to": {
            "$ref": "#/components/schemas/VersionMeta"
          },
          "format": {
            "type": "string",
            "enum": [
              "patch"
            ]
          },
          "patch": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PatchOperation"
            },
            "description": "RFC 6902 JSON Patch operations"
          }
        },
        "required": [
          "entity_id",
          "from",
          "to",
          "format",
          "patch"
        ]
      },
      "DiffResponse": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/SemanticDiffResponse"
          },
          {
            "$ref": "#/components/schemas/PatchDiffResponse"
          }
        ]
      },
      "PermissionResolution": {
        "type": "object",
        "properties": {
          "method": {
            "type": "string",
            "enum": [
              "collection",
              "self",
              "open_season"
            ],
            "description": "How permissions were resolved",
            "example": "collection"
          },
          "collection_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection ID if permissions come from a collection role",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "role": {
            "type": "string",
            "description": "Role name in the collection",
            "example": "editor"
          }
        },
        "required": [
          "method"
        ],
        "description": "How permissions were resolved"
      },
      "EntityPermissionsResponse": {
        "type": "object",
        "properties": {
          "entity_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "The entity ID",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "entity_type": {
            "type": "string",
            "description": "The entity type",
            "example": "file"
          },
          "allowed_actions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Actions the user can perform on this entity",
            "example": [
              "entity:view",
              "entity:update",
              "file:download"
            ]
          },
          "resolution": {
            "$ref": "#/components/schemas/PermissionResolution"
          }
        },
        "required": [
          "entity_id",
          "entity_type",
          "allowed_actions",
          "resolution"
        ]
      },
      "AddRelationshipResponse": {
        "type": "object",
        "properties": {
          "source": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated source entity"
              }
            ]
          },
          "target": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated target entity (present for bidirectional relationships)"
              }
            ]
          }
        },
        "required": [
          "source"
        ]
      },
      "AddRelationshipRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "source_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Source entity ID",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXPY"
          },
          "target_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Target entity ID",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXQZ"
          },
          "source_predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Predicate on source entity pointing to target",
            "example": "collection"
          },
          "target_predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Predicate on target entity pointing to source. If provided, creates bidirectional relationship.",
            "example": "root"
          },
          "expect_source_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of source entity",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "expect_target_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of target entity. Required for bidirectional relationships if target is protected.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "source_id",
          "target_id",
          "source_predicate",
          "expect_source_tip"
        ]
      },
      "RemoveRelationshipResponse": {
        "type": "object",
        "properties": {
          "source": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated source entity"
              }
            ]
          },
          "target": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated target entity (present for bidirectional relationships)"
              }
            ]
          }
        },
        "required": [
          "source"
        ]
      },
      "RemoveRelationshipRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "source_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Source entity ID",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXPY"
          },
          "target_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Target entity ID (peer of the relationship to remove)",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXQZ"
          },
          "source_predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Predicate on source entity to remove",
            "example": "collection"
          },
          "target_predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Predicate on target entity to remove. If provided, removes bidirectional relationship.",
            "example": "root"
          },
          "expect_source_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of source entity",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "expect_target_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of target entity. Required for bidirectional relationships.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "source_id",
          "target_id",
          "source_predicate",
          "expect_source_tip"
        ]
      },
      "ConnectResponse": {
        "type": "object",
        "properties": {
          "source": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated source entity with the new connection"
              }
            ]
          }
        },
        "required": [
          "source"
        ]
      },
      "ConnectRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "source_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Source entity ID (the entity you're connecting FROM)",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXPY"
          },
          "target_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Target entity ID (the entity you're connecting TO)",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXQZ"
          },
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of source entity",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Relationship predicate. Defaults to \"connects_to\".",
            "example": "connects_to"
          },
          "label": {
            "type": "string",
            "maxLength": 200,
            "description": "Optional display label for this connection",
            "example": "Related document"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "description": "Optional description explaining why this connection exists",
            "example": "Links to the supporting research paper"
          }
        },
        "required": [
          "source_id",
          "target_id",
          "expect_tip"
        ]
      },
      "DisconnectResponse": {
        "type": "object",
        "properties": {
          "source": {
            "allOf": [
              {
                "$ref": "#/components/schemas/EntityResponse"
              },
              {
                "description": "Updated source entity with the connection removed"
              }
            ]
          }
        },
        "required": [
          "source"
        ]
      },
      "DisconnectRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "source_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Source entity ID",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXPY"
          },
          "target_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Target entity ID (peer of the connection to remove)",
            "example": "01JFKY3XQWM0MJVKM8DK3AEXQZ"
          },
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected current tip CID of source entity",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "predicate": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50,
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Relationship predicate to remove. Defaults to \"connects_to\".",
            "example": "connects_to"
          }
        },
        "required": [
          "source_id",
          "target_id",
          "expect_tip"
        ]
      },
      "CreateFileResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "type": {
            "type": "string",
            "enum": [
              "file"
            ]
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "example": {
              "label": "The Pequod's Archive",
              "description": "A collection of whaling documents"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            }
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "ts": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Unix timestamp in milliseconds",
            "example": 1735214400000
          },
          "edited_by": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "minLength": 1
              },
              "method": {
                "type": "string",
                "enum": [
                  "manual",
                  "ai_generated",
                  "system",
                  "import"
                ]
              },
              "on_behalf_of": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "method"
            ],
            "description": "Audit trail for edits",
            "example": {
              "user_id": "01JCAPTAINAHAB000000000000",
              "method": "manual"
            }
          }
        },
        "required": [
          "id",
          "cid",
          "type",
          "properties",
          "relationships",
          "ver",
          "created_at",
          "ts",
          "edited_by"
        ]
      },
      "CreateFileRequest": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string",
            "minLength": 1,
            "description": "Storage key in R2. Best practice: use the CID.",
            "example": "bafkreiabc123..."
          },
          "filename": {
            "type": "string",
            "minLength": 1,
            "description": "Original filename",
            "example": "document.pdf"
          },
          "content_type": {
            "type": "string",
            "minLength": 1,
            "description": "MIME type of the file",
            "example": "application/pdf"
          },
          "size": {
            "type": "integer",
            "minimum": 0,
            "description": "Expected file size in bytes (verified on upload)",
            "example": 1048576
          },
          "label": {
            "type": "string",
            "description": "Display label for the file. Defaults to filename if not provided.",
            "example": "Q4 Financial Report"
          },
          "description": {
            "type": "string",
            "description": "Description of the file",
            "example": "Quarterly financial report for Q4 2024"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Additional properties to store",
            "example": {
              "source": "upload",
              "category": "financial"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Relationships to create"
          },
          "collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection to add this file to (for permissions). Shortcut for adding a collection relationship.",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          }
        },
        "required": [
          "key",
          "filename",
          "content_type",
          "size"
        ]
      },
      "FileResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "file"
                ]
              }
            }
          }
        ]
      },
      "UploadContentResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "file"
                ]
              },
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateFileResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/FileResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateFileRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          },
          "key": {
            "type": "string",
            "minLength": 1,
            "description": "New storage key. Must already exist in R2 (for regression to old version)."
          },
          "filename": {
            "type": "string",
            "minLength": 1,
            "description": "New filename"
          },
          "content_type": {
            "type": "string",
            "minLength": 1,
            "description": "New MIME type"
          },
          "size": {
            "type": "integer",
            "minimum": 0,
            "description": "New file size in bytes"
          },
          "label": {
            "type": "string",
            "description": "New display label"
          },
          "description": {
            "type": "string",
            "description": "New description"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "ReuploadFileResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/FileResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "ReuploadFileRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "key": {
            "type": "string",
            "minLength": 1,
            "description": "New storage key. Must NOT already exist in R2.",
            "example": "v2"
          },
          "content_type": {
            "type": "string",
            "minLength": 1,
            "description": "MIME type of the new file",
            "example": "application/pdf"
          },
          "size": {
            "type": "integer",
            "minimum": 0,
            "description": "Expected size of the new file in bytes (verified on upload)",
            "example": 2097152
          },
          "filename": {
            "type": "string",
            "minLength": 1,
            "description": "New filename (optional, keeps current if not provided)"
          },
          "label": {
            "type": "string",
            "description": "New display label (optional, keeps current if not provided)"
          },
          "description": {
            "type": "string",
            "description": "New description"
          }
        },
        "required": [
          "expect_tip",
          "key",
          "content_type",
          "size"
        ]
      },
      "CreateFolderResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "type": {
            "type": "string",
            "enum": [
              "folder"
            ]
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "example": {
              "label": "The Pequod's Archive",
              "description": "A collection of whaling documents"
            }
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            }
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "ts": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Unix timestamp in milliseconds",
            "example": 1735214400000
          },
          "edited_by": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "minLength": 1
              },
              "method": {
                "type": "string",
                "enum": [
                  "manual",
                  "ai_generated",
                  "system",
                  "import"
                ]
              },
              "on_behalf_of": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "method"
            ],
            "description": "Audit trail for edits",
            "example": {
              "user_id": "01JCAPTAINAHAB000000000000",
              "method": "manual"
            }
          }
        },
        "required": [
          "id",
          "cid",
          "type",
          "properties",
          "relationships",
          "ver",
          "created_at",
          "ts",
          "edited_by"
        ]
      },
      "CreateFolderRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "description": "Display name for the folder",
            "example": "Research Documents"
          },
          "description": {
            "type": "string",
            "description": "Short description"
          },
          "rich_description": {
            "type": "string",
            "description": "Rich content description (markdown)"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Flexible metadata"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Additional properties to store"
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Relationships to create"
          },
          "collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection to add folder to (for permissions). Shortcut for adding a collection relationship.",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "parent": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Parent folder ID (creates bidirectional relationship)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          }
        },
        "required": [
          "label"
        ]
      },
      "FolderResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "folder"
                ]
              }
            }
          }
        ]
      },
      "UpdateFolderResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/FolderResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateFolderRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "description": "New display name"
          },
          "description": {
            "type": "string",
            "description": "New description"
          },
          "rich_description": {
            "type": "string",
            "description": "New rich description"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "New metadata (deep merged)"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "AddChildResponse": {
        "type": "object",
        "properties": {
          "folder": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated folder"
              }
            ]
          },
          "child": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "Entity ID (ULID format)",
                "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
              },
              "cid": {
                "type": "string",
                "minLength": 1,
                "description": "Content Identifier (CID) - content-addressed hash",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "id",
              "cid"
            ],
            "description": "Updated child info"
          }
        },
        "required": [
          "folder",
          "child"
        ]
      },
      "AddChildRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "child_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Child entity ID to add (file or folder)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "expect_child_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected CID of child (CAS guard, optional if child in open season)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "expect_tip",
          "child_id"
        ]
      },
      "RemoveChildResponse": {
        "type": "object",
        "properties": {
          "folder": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated folder"
              }
            ]
          },
          "child": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "Entity ID (ULID format)",
                "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
              },
              "cid": {
                "type": "string",
                "minLength": 1,
                "description": "Content Identifier (CID) - content-addressed hash",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "id",
              "cid"
            ],
            "description": "Updated child info"
          }
        },
        "required": [
          "folder",
          "child"
        ]
      },
      "RemoveChildRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "expect_child_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected CID of child (CAS guard)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "expect_tip",
          "expect_child_tip"
        ]
      },
      "BulkAddChildrenResponse": {
        "type": "object",
        "properties": {
          "folder": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated folder"
              }
            ]
          },
          "added": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "Entity ID (ULID format)",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "cid": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Content Identifier (CID) - content-addressed hash",
                  "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
                }
              },
              "required": [
                "id",
                "cid"
              ]
            },
            "description": "Children that were added"
          },
          "skipped": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "description": "Children that were skipped (already existed)"
          }
        },
        "required": [
          "folder",
          "added",
          "skipped"
        ]
      },
      "BulkAddChildrenRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "children": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "Entity ID (ULID format)",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "type": {
                  "type": "string"
                }
              },
              "required": [
                "id"
              ]
            },
            "minItems": 1,
            "maxItems": 50,
            "description": "Children to add (max 50 per request)",
            "example": [
              {
                "id": "01JFILE123ABCDEFGHJKMNPQRS"
              },
              {
                "id": "01JFOLDER456ABCDEFGHJKMNPQ",
                "type": "folder"
              }
            ]
          }
        },
        "required": [
          "expect_tip",
          "children"
        ]
      },
      "AddParentResponse": {
        "type": "object",
        "properties": {
          "folder": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated folder"
              }
            ]
          },
          "parent": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated parent folder"
              }
            ]
          }
        },
        "required": [
          "folder",
          "parent"
        ]
      },
      "AddParentRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "parent_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Parent folder or collection ID to add",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "expect_parent_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected CID of parent (CAS guard, optional if parent in open season)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "expect_tip",
          "parent_id"
        ]
      },
      "RemoveParentResponse": {
        "type": "object",
        "properties": {
          "folder": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated folder"
              }
            ]
          },
          "parent": {
            "allOf": [
              {
                "$ref": "#/components/schemas/FolderResponse"
              },
              {
                "description": "Updated parent folder"
              }
            ]
          }
        },
        "required": [
          "folder",
          "parent"
        ]
      },
      "RemoveParentRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "expect_parent_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Expected CID of parent (CAS guard)",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "expect_tip",
          "expect_parent_tip"
        ]
      },
      "VersionInfo": {
        "type": "object",
        "properties": {
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ts": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "edited_by": {
            "type": "object",
            "properties": {
              "user_id": {
                "type": "string",
                "minLength": 1
              },
              "method": {
                "type": "string",
                "enum": [
                  "manual",
                  "ai_generated",
                  "system",
                  "import"
                ]
              },
              "on_behalf_of": {
                "type": "string"
              }
            },
            "required": [
              "user_id",
              "method"
            ],
            "description": "Audit trail for edits",
            "example": {
              "user_id": "01JCAPTAINAHAB000000000000",
              "method": "manual"
            }
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this version"
          },
          "arweave_tx": {
            "type": "string",
            "description": "Arweave transaction ID if this version has been attested",
            "example": "abc123xyz..."
          },
          "arweave_url": {
            "type": "string",
            "format": "uri",
            "description": "Arweave gateway URL for the attestation",
            "example": "https://arweave.net/abc123xyz..."
          }
        },
        "required": [
          "ver",
          "cid",
          "ts",
          "edited_by"
        ]
      },
      "VersionListResponse": {
        "type": "object",
        "properties": {
          "entity_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "versions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/VersionInfo"
            },
            "description": "Version metadata array (newest first)"
          },
          "has_more": {
            "type": "boolean",
            "description": "Whether more versions exist beyond this page"
          },
          "next_cursor": {
            "type": "string",
            "nullable": true,
            "minLength": 1,
            "description": "CID to use as \"from\" parameter for next page",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          }
        },
        "required": [
          "entity_id",
          "versions",
          "has_more",
          "next_cursor"
        ]
      },
      "ManifestResponse": {
        "type": "object",
        "properties": {
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "manifest": {
            "type": "object",
            "properties": {
              "schema": {
                "type": "string",
                "example": "arke/eidos@v1"
              },
              "id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "Entity ID (ULID format)",
                "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
              },
              "type": {
                "type": "string",
                "example": "document"
              },
              "created_at": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 datetime",
                "example": "2025-12-26T12:00:00.000Z"
              },
              "ver": {
                "type": "integer",
                "minimum": 0,
                "exclusiveMinimum": true,
                "description": "Entity version number",
                "example": 1
              },
              "ts": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 datetime",
                "example": "2025-12-26T12:00:00.000Z"
              },
              "prev": {
                "type": "object",
                "nullable": true,
                "properties": {
                  "/": {
                    "type": "string",
                    "minLength": 1
                  }
                },
                "required": [
                  "/"
                ],
                "description": "IPLD link to previous version (null for v1)",
                "example": {
                  "/": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
                }
              },
              "properties": {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Entity properties"
              },
              "relationships": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "predicate": {
                      "type": "string",
                      "minLength": 1
                    },
                    "peer": {
                      "type": "string",
                      "minLength": 1
                    },
                    "peer_type": {
                      "type": "string"
                    },
                    "peer_label": {
                      "type": "string"
                    },
                    "properties": {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  },
                  "required": [
                    "predicate",
                    "peer"
                  ],
                  "description": "Entity relationship",
                  "example": {
                    "predicate": "crew",
                    "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                    "peer_type": "collection"
                  }
                }
              },
              "edited_by": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "string",
                    "minLength": 1
                  },
                  "method": {
                    "type": "string",
                    "enum": [
                      "manual",
                      "ai_generated",
                      "system",
                      "import"
                    ]
                  },
                  "on_behalf_of": {
                    "type": "string"
                  }
                },
                "required": [
                  "user_id",
                  "method"
                ],
                "description": "Audit trail for edits",
                "example": {
                  "user_id": "01JCAPTAINAHAB000000000000",
                  "method": "manual"
                }
              },
              "note": {
                "type": "string"
              }
            },
            "required": [
              "schema",
              "id",
              "type",
              "created_at",
              "ver",
              "ts",
              "prev",
              "properties",
              "relationships",
              "edited_by"
            ],
            "description": "The full manifest at this version"
          }
        },
        "required": [
          "cid",
          "manifest"
        ]
      },
      "TypeRestriction": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "The type with restricted implications",
            "example": "collection"
          },
          "allowed_verbs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Verbs for which the base type DOES imply this type",
            "example": [
              "view"
            ]
          },
          "description": {
            "type": "string",
            "description": "Explanation of the restriction"
          }
        },
        "required": [
          "type",
          "allowed_verbs",
          "description"
        ]
      },
      "TypeHierarchy": {
        "type": "object",
        "properties": {
          "base_type": {
            "type": "string",
            "description": "The base type that implies all other types",
            "example": "entity"
          },
          "description": {
            "type": "string",
            "description": "Explanation of type hierarchy behavior"
          },
          "restrictions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TypeRestriction"
            },
            "description": "Types with restricted implication rules"
          }
        },
        "required": [
          "base_type",
          "description",
          "restrictions"
        ],
        "description": "Type hierarchy. The base type implies all other types, with restrictions for certain types."
      },
      "WildcardInfo": {
        "type": "object",
        "properties": {
          "pattern": {
            "type": "string",
            "description": "The wildcard pattern format",
            "example": "*:{verb}"
          },
          "example": {
            "type": "string",
            "description": "An example of the pattern in use",
            "example": "*:view"
          },
          "description": {
            "type": "string",
            "description": "Explanation of what this pattern matches"
          }
        },
        "required": [
          "pattern",
          "example",
          "description"
        ],
        "description": "Verb wildcard pattern (*:verb)"
      },
      "PermissionsResponse": {
        "type": "object",
        "properties": {
          "actions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "All registered action strings in the system",
            "example": [
              "entity:view",
              "entity:create",
              "file:download"
            ]
          },
          "verbs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "All unique verbs (the part after the colon)",
            "example": [
              "view",
              "create",
              "update",
              "delete",
              "download"
            ]
          },
          "types": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "All unique types (the part before the colon)",
            "example": [
              "entity",
              "user",
              "collection",
              "file"
            ]
          },
          "implications": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Verb implications. If you have a verb, you also have its implied verbs. Example: view implies download.",
            "example": {
              "view": [
                "download"
              ],
              "update": [
                "reupload"
              ]
            }
          },
          "type_hierarchy": {
            "$ref": "#/components/schemas/TypeHierarchy"
          },
          "wildcards": {
            "type": "object",
            "properties": {
              "verb": {
                "$ref": "#/components/schemas/WildcardInfo"
              },
              "type": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/WildcardInfo"
                  },
                  {
                    "description": "Type wildcard pattern (type:*)"
                  }
                ]
              }
            },
            "required": [
              "verb",
              "type"
            ],
            "description": "Wildcard pattern documentation"
          },
          "restrictions": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Security restrictions and special rules",
            "example": [
              "collection:* is not allowed - use explicit collection actions"
            ]
          },
          "default_roles": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Default role definitions used when creating new collections",
            "example": {
              "owner": [
                "*:view",
                "*:update",
                "*:create",
                "collection:manage"
              ],
              "viewer": [
                "*:view"
              ]
            }
          }
        },
        "required": [
          "actions",
          "verbs",
          "types",
          "implications",
          "type_hierarchy",
          "wildcards",
          "restrictions",
          "default_roles"
        ]
      },
      "AgentResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EntityResponse"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "agent"
                ]
              },
              "warnings": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "sub_agent_id": {
                      "type": "string",
                      "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                      "description": "The sub-agent ID that has an issue"
                    },
                    "reason": {
                      "type": "string",
                      "enum": [
                        "not_found",
                        "not_an_agent",
                        "disabled"
                      ],
                      "description": "Why this is a warning: not_found (entity does not exist), not_an_agent (entity exists but is not an agent), or disabled (agent is disabled)"
                    },
                    "message": {
                      "type": "string",
                      "description": "Human-readable explanation"
                    }
                  },
                  "required": [
                    "sub_agent_id",
                    "reason",
                    "message"
                  ],
                  "description": "Warning about a sub-agent reference that could not be validated. The agent is still created/updated, but this sub-agent may cause issues at invocation time.",
                  "title": "AgentSubAgentWarning"
                },
                "description": "Warnings about sub-agent references that could not be validated. Present only when uses_agents contains references to non-existent, non-agent, or disabled entities."
              }
            }
          }
        ]
      },
      "CreateAgentRequest": {
        "type": "object",
        "properties": {
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Custom entity ID (generated if not provided)"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Agent display name",
            "example": "OCR Processor"
          },
          "endpoint": {
            "type": "string",
            "format": "uri",
            "description": "Agent service base URL",
            "example": "https://ocr.example.com/v1"
          },
          "actions_required": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[a-z_]+:[a-z_]+$"
            },
            "minItems": 1,
            "description": "Actions this agent requires on target collections",
            "example": [
              "entity:view",
              "entity:update",
              "file:create"
            ]
          },
          "collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection to place agent in"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "description": "Agent description",
            "example": "Extracts text from scanned documents using OCR"
          },
          "uses_agents": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "pi": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "Sub-agent entity ID. The sub-agent's actions_required will be fetched dynamically at invocation time."
                },
                "label": {
                  "type": "string",
                  "maxLength": 200,
                  "description": "Optional display label override (defaults to sub-agent's own label)"
                },
                "description": {
                  "type": "string",
                  "maxLength": 2000,
                  "description": "Optional description of the sub-agent's role in this orchestrator's workflow"
                }
              },
              "required": [
                "pi"
              ],
              "description": "Reference to a sub-agent. Permissions are NOT declared here - they are fetched dynamically from the sub-agent's own manifest at invocation time. This means sub-agent permission changes propagate automatically without updating the orchestrator.",
              "title": "SubAgentRef"
            },
            "description": "Sub-agents this orchestrator delegates work to. Only provide the sub-agent ID (pi) - their permissions are fetched dynamically at invocation time. Warnings are returned if any referenced sub-agents do not exist or are disabled."
          },
          "input_schema": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "JSON Schema for input validation"
          },
          "output_schema": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "JSON Schema for output description"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Additional properties to store"
          },
          "relationships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1
                },
                "peer": {
                  "type": "string",
                  "minLength": 1
                },
                "peer_type": {
                  "type": "string"
                },
                "peer_label": {
                  "type": "string"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  }
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Entity relationship",
              "example": {
                "predicate": "crew",
                "peer": "01KDETYWYWM0MJVKM8DK3AEXPY",
                "peer_type": "collection"
              }
            },
            "description": "Relationships to create"
          }
        },
        "required": [
          "label",
          "endpoint",
          "actions_required",
          "collection"
        ]
      },
      "AgentUpdateResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/AgentResponse"
          },
          {
            "type": "object",
            "properties": {
              "prev_cid": {
                "type": "string",
                "minLength": 1,
                "description": "Previous version CID",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              }
            },
            "required": [
              "prev_cid"
            ]
          }
        ]
      },
      "UpdateAgentRequest": {
        "type": "object",
        "properties": {
          "expect_tip": {
            "type": "string",
            "minLength": 1,
            "description": "Current tip CID for CAS validation. Request fails with 409 if this does not match.",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "note": {
            "type": "string",
            "description": "Optional note describing this change",
            "example": "Added Chapter 42: The Whiteness of the Whale"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Properties to add or update (deep merged)"
          },
          "properties_remove": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top-level property keys to remove",
                "example": [
                  "deprecated_field",
                  "old_field"
                ]
              },
              {
                "type": "object",
                "additionalProperties": {
                  "nullable": true
                },
                "description": "Nested removal structure. Each key navigates into a nested object; leaf arrays specify keys to delete at that level.",
                "example": {
                  "settings": {
                    "notifications": [
                      "email",
                      "slack"
                    ]
                  }
                }
              }
            ],
            "description": "Properties to remove. Use string[] for top-level keys (e.g., [\"old_field\"]), or nested objects for deep removal (e.g., { config: { options: [\"debug\"] } }). Dot notation like \"config.options.debug\" is NOT supported."
          },
          "relationships_add": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate (e.g., \"admin\", \"contains\", \"collection\")",
                  "example": "admin"
                },
                "peer": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Target entity ID",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                },
                "peer_type": {
                  "type": "string",
                  "description": "Target entity type hint",
                  "example": "user"
                },
                "peer_label": {
                  "type": "string",
                  "description": "Target entity label hint",
                  "example": "Captain Ahab"
                },
                "properties": {
                  "type": "object",
                  "additionalProperties": {
                    "nullable": true
                  },
                  "description": "Properties to add/update on this relationship (deep merged if relationship exists)",
                  "example": {
                    "expires_at": "2025-12-31T00:00:00Z"
                  }
                },
                "properties_remove": {
                  "anyOf": [
                    {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    {
                      "type": "object",
                      "additionalProperties": {
                        "nullable": true
                      }
                    }
                  ],
                  "description": "Properties to remove from this relationship (string array or nested object)"
                }
              },
              "required": [
                "predicate",
                "peer"
              ],
              "description": "Relationship to add or update (upsert semantics)"
            },
            "description": "Relationships to add or update (upsert semantics)"
          },
          "relationships_remove": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "predicate": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Relationship predicate",
                  "example": "viewer"
                },
                "peer": {
                  "type": "string",
                  "description": "Target entity ID. If omitted, removes ALL relationships with this predicate.",
                  "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
                }
              },
              "required": [
                "predicate"
              ],
              "description": "Relationship to remove"
            },
            "description": "Relationships to remove"
          },
          "label": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Updated agent display name"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "description": "Updated agent description"
          },
          "endpoint": {
            "type": "string",
            "format": "uri",
            "description": "Updated agent service URL"
          },
          "actions_required": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[a-z_]+:[a-z_]+$"
            },
            "minItems": 1,
            "description": "Actions this agent requires on target collections",
            "example": [
              "entity:view",
              "entity:update",
              "file:create"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "development",
              "active",
              "disabled"
            ],
            "description": "Agent status",
            "example": "development"
          },
          "uses_agents": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "pi": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "Sub-agent entity ID. The sub-agent's actions_required will be fetched dynamically at invocation time."
                },
                "label": {
                  "type": "string",
                  "maxLength": 200,
                  "description": "Optional display label override (defaults to sub-agent's own label)"
                },
                "description": {
                  "type": "string",
                  "maxLength": 2000,
                  "description": "Optional description of the sub-agent's role in this orchestrator's workflow"
                }
              },
              "required": [
                "pi"
              ],
              "description": "Reference to a sub-agent. Permissions are NOT declared here - they are fetched dynamically from the sub-agent's own manifest at invocation time. This means sub-agent permission changes propagate automatically without updating the orchestrator.",
              "title": "SubAgentRef"
            },
            "description": "Updated sub-agent references. Only provide sub-agent IDs (pi) - their permissions are fetched dynamically at invocation time."
          },
          "input_schema": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Updated input schema"
          },
          "output_schema": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Updated output schema"
          }
        },
        "required": [
          "expect_tip"
        ]
      },
      "InvokeGrant": {
        "type": "object",
        "properties": {
          "agent": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "id",
              "label"
            ]
          },
          "actions": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "role": {
            "type": "string"
          },
          "already_granted": {
            "type": "boolean"
          },
          "expired": {
            "type": "boolean"
          },
          "missing_actions": {
            "type": "boolean"
          },
          "current_expires_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "agent",
          "actions",
          "role",
          "already_granted"
        ]
      },
      "InvokePreviewResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "pending_confirmation"
            ]
          },
          "message": {
            "type": "string"
          },
          "grants": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InvokeGrant"
            }
          },
          "target": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "id",
              "label"
            ]
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          },
          "can_proceed": {
            "type": "boolean",
            "description": "True if all grants exist or user can create them"
          },
          "grants_needed": {
            "type": "boolean",
            "description": "True if some agents need permission grants"
          },
          "warnings": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "sub_agent_id": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "The sub-agent ID that could not be resolved"
                },
                "parent_agent_id": {
                  "type": "string",
                  "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                  "description": "The orchestrator or parent agent that declared this sub-agent reference"
                },
                "reason": {
                  "type": "string",
                  "enum": [
                    "not_found",
                    "disabled"
                  ],
                  "description": "Why the sub-agent was skipped: not_found (entity does not exist) or disabled (agent status is disabled)"
                },
                "message": {
                  "type": "string",
                  "description": "Human-readable explanation of the warning"
                }
              },
              "required": [
                "sub_agent_id",
                "parent_agent_id",
                "reason",
                "message"
              ],
              "description": "Warning generated when a sub-agent reference cannot be resolved during dynamic permission lookup. The agent creation/invocation proceeds, but the sub-agent is skipped.",
              "title": "SubAgentWarning"
            },
            "description": "Warnings about sub-agents that were skipped"
          }
        },
        "required": [
          "status",
          "message",
          "grants",
          "target",
          "expires_at",
          "can_proceed",
          "grants_needed"
        ]
      },
      "InvokeGrantResult": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$"
          },
          "role": {
            "type": "string"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          },
          "was_update": {
            "type": "boolean"
          }
        },
        "required": [
          "agent_id",
          "role",
          "expires_at",
          "was_update"
        ]
      },
      "InvokeStartedResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "started"
            ]
          },
          "job_id": {
            "type": "string",
            "description": "Unique job identifier",
            "example": "job_01JEXAMPLEID12345678901"
          },
          "job_collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "The job collection where agent writes logs"
          },
          "grants": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InvokeGrantResult"
            }
          },
          "target_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "status",
          "job_id",
          "job_collection",
          "grants",
          "target_cid",
          "expires_at"
        ]
      },
      "InvokeRejectedResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "rejected"
            ]
          },
          "error": {
            "type": "string",
            "description": "Error message explaining why the agent rejected the job"
          },
          "retry_after": {
            "type": "integer",
            "description": "Suggested seconds to wait before retrying"
          },
          "grants": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InvokeGrantResult"
            }
          },
          "target_cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "status",
          "error",
          "grants",
          "target_cid",
          "expires_at"
        ]
      },
      "InvokeConfirmedResponse": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/InvokeStartedResponse"
          },
          {
            "$ref": "#/components/schemas/InvokeRejectedResponse"
          }
        ]
      },
      "InvokeAgentRequest": {
        "type": "object",
        "properties": {
          "target": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Collection ID to grant the agent access to. All agent permissions are collection-scoped."
          },
          "job_collection": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Job collection where agent should write logs. If not provided, creates new root collection."
          },
          "input": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            },
            "description": "Input data for the agent (validated against agent input_schema)"
          },
          "expires_in": {
            "type": "integer",
            "minimum": 60,
            "maximum": 86400,
            "default": 3600,
            "description": "Permission duration in seconds (60-86400, default: 3600)",
            "example": 3600
          },
          "confirm": {
            "type": "boolean",
            "default": false,
            "description": "false = preview grants, true = execute agent",
            "example": false
          }
        },
        "required": [
          "target"
        ]
      },
      "CreateAgentApiKeyResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "key": {
            "type": "string",
            "description": "Full API key - store securely, shown only once",
            "example": "ak_abc123..."
          },
          "prefix": {
            "type": "string",
            "description": "Key prefix for identification",
            "example": "ak_abc1"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          },
          "label": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "id",
          "key",
          "prefix",
          "created_at",
          "expires_at",
          "label"
        ]
      },
      "CreateAgentApiKeyRequest": {
        "type": "object",
        "properties": {
          "label": {
            "type": "string",
            "maxLength": 100,
            "description": "Human-readable label for the key",
            "example": "Production key"
          },
          "expires_in_days": {
            "type": "integer",
            "minimum": 1,
            "maximum": 365,
            "default": 365,
            "description": "Key expiration in days (1-365, default: 365)",
            "example": 90
          }
        }
      },
      "AgentApiKeyInfo": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "prefix": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time"
          },
          "last_used_at": {
            "type": "string",
            "nullable": true,
            "format": "date-time"
          },
          "label": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "id",
          "prefix",
          "created_at",
          "expires_at",
          "last_used_at",
          "label"
        ]
      },
      "ListAgentApiKeysResponse": {
        "type": "object",
        "properties": {
          "keys": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AgentApiKeyInfo"
            }
          }
        },
        "required": [
          "keys"
        ]
      },
      "VerifyAgentTokenResponse": {
        "type": "object",
        "properties": {
          "verification_token": {
            "type": "string",
            "description": "Token to deploy at your endpoint",
            "example": "vt_abc123def456..."
          },
          "agent_id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Agent ID to include in verification response"
          },
          "endpoint": {
            "type": "string",
            "format": "uri",
            "description": "Your agent endpoint URL"
          },
          "instructions": {
            "type": "string",
            "description": "How to complete verification"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "Token expiration time"
          }
        },
        "required": [
          "verification_token",
          "agent_id",
          "endpoint",
          "instructions",
          "expires_at"
        ]
      },
      "VerifyAgentSuccessResponse": {
        "type": "object",
        "properties": {
          "verified": {
            "type": "boolean",
            "enum": [
              true
            ]
          },
          "verified_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the endpoint was verified"
          }
        },
        "required": [
          "verified",
          "verified_at"
        ]
      },
      "VerifyAgentFailureResponse": {
        "type": "object",
        "properties": {
          "verified": {
            "type": "boolean",
            "enum": [
              false
            ]
          },
          "error": {
            "type": "string",
            "enum": [
              "no_token",
              "token_expired",
              "fetch_failed",
              "invalid_response",
              "token_mismatch",
              "agent_id_mismatch"
            ],
            "description": "Verification error code"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error description"
          }
        },
        "required": [
          "verified",
          "error",
          "message"
        ]
      },
      "VerifyAgentRequest": {
        "type": "object",
        "properties": {
          "confirm": {
            "type": "boolean",
            "description": "Set to true to perform verification. Omit or false to generate/get verification token.",
            "example": true
          }
        }
      },
      "EntityRef": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string"
          },
          "label": {
            "type": "string"
          }
        },
        "required": [
          "pi"
        ]
      },
      "JobStatusResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "status": {
            "type": "string",
            "enum": [
              "running",
              "done",
              "error"
            ],
            "description": "Job collection status",
            "example": "running"
          },
          "started_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "completed_at": {
            "type": "string",
            "nullable": true,
            "format": "date-time",
            "description": "ISO 8601 datetime",
            "example": "2025-12-26T12:00:00.000Z"
          },
          "agent": {
            "$ref": "#/components/schemas/EntityRef"
          },
          "target": {
            "$ref": "#/components/schemas/EntityRef"
          },
          "main_agent": {
            "$ref": "#/components/schemas/EntityRef"
          },
          "files_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of files contained in this job collection",
            "example": 5
          },
          "sub_jobs_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of sub-job collections",
            "example": 2
          }
        },
        "required": [
          "id",
          "cid",
          "status",
          "started_at",
          "completed_at",
          "agent",
          "files_count",
          "sub_jobs_count"
        ]
      },
      "Event": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "Auto-increment event ID (use as cursor)",
            "example": 12346
          },
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID that changed",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "New manifest CID",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "ts": {
            "type": "string",
            "description": "ISO timestamp of the event",
            "example": "2025-01-15T12:00:01Z"
          }
        },
        "required": [
          "id",
          "pi",
          "cid",
          "ts"
        ]
      },
      "EventsListResponse": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Event"
            },
            "description": "List of events (newest first)"
          },
          "has_more": {
            "type": "boolean",
            "description": "Whether there are more (older) events available",
            "example": true
          },
          "cursor": {
            "type": "integer",
            "description": "Cursor for the next page (oldest id in batch, pass as ?cursor= for older events)",
            "example": 12340
          }
        },
        "required": [
          "events",
          "has_more",
          "cursor"
        ]
      },
      "PathEdge": {
        "type": "object",
        "properties": {
          "subject_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Source entity PI",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "subject_label": {
            "type": "string",
            "description": "Source entity label"
          },
          "subject_type": {
            "type": "string",
            "description": "Source entity type"
          },
          "predicate": {
            "type": "string",
            "description": "Relationship predicate"
          },
          "object_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Target entity PI",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "object_label": {
            "type": "string",
            "description": "Target entity label"
          },
          "object_type": {
            "type": "string",
            "description": "Target entity type"
          }
        },
        "required": [
          "subject_pi",
          "subject_label",
          "subject_type",
          "predicate",
          "object_pi",
          "object_label",
          "object_type"
        ]
      },
      "PathResult": {
        "type": "object",
        "properties": {
          "source_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "target_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "length": {
            "type": "integer",
            "description": "Path length (number of hops)"
          },
          "edges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PathEdge"
            }
          }
        },
        "required": [
          "source_pi",
          "target_pi",
          "length",
          "edges"
        ]
      },
      "PathsBetweenResponse": {
        "type": "object",
        "properties": {
          "paths": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PathResult"
            }
          },
          "truncated": {
            "type": "boolean",
            "description": "Whether results were truncated due to limit"
          }
        },
        "required": [
          "paths",
          "truncated"
        ]
      },
      "PathsBetweenRequest": {
        "type": "object",
        "properties": {
          "source_pis": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "minItems": 1,
            "description": "Starting entity PIs",
            "example": [
              "01KE4ZY69F9R40E88PK9S0TQRQ"
            ]
          },
          "target_pis": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "minItems": 1,
            "description": "Target entity PIs",
            "example": [
              "01KE506KZGD8M2P1XK3VNQT4YR"
            ]
          },
          "max_depth": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4,
            "default": 4,
            "description": "Maximum path depth (1-4)",
            "example": 3
          },
          "direction": {
            "type": "string",
            "enum": [
              "outgoing",
              "incoming",
              "both"
            ],
            "default": "both",
            "description": "Relationship traversal direction",
            "example": "both"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000,
            "default": 100,
            "description": "Maximum number of paths to return",
            "example": 10
          }
        },
        "required": [
          "source_pis",
          "target_pis"
        ]
      },
      "ReachableResult": {
        "type": "object",
        "properties": {
          "source_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "target_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "target_label": {
            "type": "string"
          },
          "target_type": {
            "type": "string"
          },
          "length": {
            "type": "integer",
            "description": "Path length (number of hops)"
          },
          "edges": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PathEdge"
            }
          }
        },
        "required": [
          "source_pi",
          "target_pi",
          "target_label",
          "target_type",
          "length",
          "edges"
        ]
      },
      "PathsReachableResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ReachableResult"
            }
          },
          "truncated": {
            "type": "boolean",
            "description": "Whether results were truncated due to limit"
          }
        },
        "required": [
          "results",
          "truncated"
        ]
      },
      "PathsReachableRequest": {
        "type": "object",
        "properties": {
          "source_pis": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "minItems": 1,
            "description": "Starting entity PIs",
            "example": [
              "01KE4ZY69F9R40E88PK9S0TQRQ"
            ]
          },
          "target_type": {
            "type": "string",
            "minLength": 1,
            "description": "Target entity type to find",
            "example": "file"
          },
          "max_depth": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4,
            "default": 4,
            "description": "Maximum path depth (1-4)",
            "example": 3
          },
          "direction": {
            "type": "string",
            "enum": [
              "outgoing",
              "incoming",
              "both"
            ],
            "default": "both",
            "description": "Relationship traversal direction",
            "example": "both"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000,
            "default": 100,
            "description": "Maximum number of results to return",
            "example": 50
          }
        },
        "required": [
          "source_pis",
          "target_type"
        ]
      },
      "RelationshipInfo": {
        "type": "object",
        "properties": {
          "direction": {
            "type": "string",
            "enum": [
              "outgoing",
              "incoming"
            ]
          },
          "predicate": {
            "type": "string"
          },
          "peer_pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "peer_type": {
            "type": "string"
          },
          "peer_label": {
            "type": "string"
          },
          "properties": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            }
          }
        },
        "required": [
          "direction",
          "predicate",
          "peer_pi",
          "peer_type",
          "peer_label",
          "properties"
        ]
      },
      "GraphEntityResponse": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string"
          },
          "label": {
            "type": "string"
          },
          "collection_pi": {
            "type": "string",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "relationships": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RelationshipInfo"
            }
          }
        },
        "required": [
          "pi",
          "type",
          "label",
          "collection_pi",
          "created_at",
          "updated_at",
          "relationships"
        ]
      },
      "QueryEntity": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "type": {
            "type": "string"
          },
          "label": {
            "type": "string"
          },
          "collection_pi": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "pi",
          "type",
          "label",
          "collection_pi"
        ]
      },
      "EntityStep": {
        "type": "object",
        "properties": {
          "entity": {
            "type": "string"
          },
          "label": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "score": {
            "type": "number"
          }
        },
        "required": [
          "entity"
        ]
      },
      "EdgeStep": {
        "type": "object",
        "properties": {
          "edge": {
            "type": "string"
          },
          "direction": {
            "type": "string",
            "enum": [
              "outgoing",
              "incoming"
            ]
          },
          "score": {
            "type": "number"
          }
        },
        "required": [
          "edge",
          "direction"
        ]
      },
      "PathStep": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/EntityStep"
          },
          {
            "$ref": "#/components/schemas/EdgeStep"
          }
        ]
      },
      "QueryResultItem": {
        "type": "object",
        "properties": {
          "entity": {
            "$ref": "#/components/schemas/QueryEntity"
          },
          "path": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PathStep"
            }
          },
          "score": {
            "type": "number"
          }
        },
        "required": [
          "entity",
          "path",
          "score"
        ]
      },
      "QueryMetadata": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string"
          },
          "hops": {
            "type": "integer"
          },
          "k": {
            "type": "integer"
          },
          "k_explore": {
            "type": "integer"
          },
          "total_candidates_explored": {
            "type": "integer"
          },
          "execution_time_ms": {
            "type": "number"
          },
          "collection": {
            "type": "string"
          },
          "error": {
            "type": "string"
          },
          "reason": {
            "type": "string"
          },
          "partial_path": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PathStep"
            }
          },
          "stopped_at_hop": {
            "type": "integer"
          }
        },
        "required": [
          "query",
          "hops",
          "k",
          "k_explore",
          "total_candidates_explored",
          "execution_time_ms"
        ]
      },
      "QueryResponse": {
        "type": "object",
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/QueryResultItem"
            }
          },
          "metadata": {
            "$ref": "#/components/schemas/QueryMetadata"
          }
        },
        "required": [
          "results",
          "metadata"
        ]
      },
      "QueryRequest": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "minLength": 1,
            "description": "Argo query string",
            "example": "\"medical college\" -[*]{,4}-> type:file"
          },
          "k": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 25,
            "description": "Maximum number of results to return",
            "example": 25
          },
          "k_explore": {
            "type": "integer",
            "minimum": 1,
            "maximum": 300,
            "description": "Beam width for exploration (default: k * 3)",
            "example": 75
          },
          "collection": {
            "type": "string",
            "description": "Scope query to collection PI",
            "example": "01JCOLL_MEDICAL"
          }
        },
        "required": [
          "path"
        ]
      },
      "TextPart": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "text"
            ]
          },
          "text": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "text"
        ]
      },
      "ToolPart": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string"
          },
          "toolCallId": {
            "type": "string"
          },
          "toolName": {
            "type": "string"
          },
          "args": {
            "type": "object",
            "additionalProperties": {
              "nullable": true
            }
          },
          "output": {
            "nullable": true
          },
          "state": {
            "type": "string",
            "enum": [
              "partial-call",
              "call",
              "output-available"
            ]
          }
        },
        "required": [
          "type"
        ]
      },
      "MessagePart": {
        "anyOf": [
          {
            "$ref": "#/components/schemas/TextPart"
          },
          {
            "$ref": "#/components/schemas/ToolPart"
          },
          {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              }
            },
            "required": [
              "type"
            ]
          }
        ]
      },
      "ChatMessage": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "user",
              "assistant",
              "system",
              "tool"
            ]
          },
          "parts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MessagePart"
            }
          },
          "content": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "role"
        ]
      },
      "SendChatRequest": {
        "type": "object",
        "properties": {
          "messages": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ChatMessage"
            },
            "description": "Array of chat messages in AI SDK v5 UIMessage format"
          }
        },
        "required": [
          "messages"
        ]
      },
      "ChatSession": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Chat session ID",
            "example": "chat_abc123"
          },
          "createdAt": {
            "type": "string",
            "description": "ISO 8601 creation timestamp",
            "example": "2025-01-14T12:00:00.000Z"
          },
          "updatedAt": {
            "type": "string",
            "description": "ISO 8601 last update timestamp",
            "example": "2025-01-14T12:30:00.000Z"
          },
          "ownerId": {
            "type": "string",
            "nullable": true,
            "description": "Owner user ID (Arke PI or Supabase ID)"
          },
          "title": {
            "type": "string",
            "nullable": true,
            "description": "Auto-generated chat title from first message",
            "example": "Help me understand the codebase..."
          },
          "messages": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "role": {
                  "type": "string",
                  "enum": [
                    "user",
                    "assistant",
                    "system",
                    "tool"
                  ]
                },
                "content": {
                  "type": "string"
                },
                "createdAt": {
                  "type": "string"
                },
                "toolInvocations": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "toolCallId": {
                        "type": "string"
                      },
                      "toolName": {
                        "type": "string"
                      },
                      "args": {
                        "type": "object",
                        "additionalProperties": {
                          "nullable": true
                        }
                      },
                      "result": {
                        "nullable": true
                      },
                      "state": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "toolCallId",
                      "toolName",
                      "state"
                    ]
                  }
                }
              },
              "required": [
                "id",
                "role",
                "content",
                "createdAt"
              ]
            },
            "description": "Full message history (only included in session detail)"
          }
        },
        "required": [
          "id",
          "createdAt",
          "updatedAt",
          "ownerId",
          "title"
        ]
      },
      "ChatSessionDeleteResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          }
        },
        "required": [
          "success"
        ]
      },
      "AttestationResponse": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "arweave_tx": {
            "type": "string",
            "description": "Arweave transaction ID",
            "example": "abc123xyz..."
          },
          "arweave_url": {
            "type": "string",
            "format": "uri",
            "description": "Arweave gateway URL for direct access",
            "example": "https://arweave.net/abc123xyz..."
          },
          "ts": {
            "type": "number",
            "description": "Unix timestamp (milliseconds) of the operation",
            "example": 1704455200000
          }
        },
        "required": [
          "pi",
          "ver",
          "cid",
          "arweave_tx",
          "arweave_url",
          "ts"
        ]
      },
      "AttestationPendingResponse": {
        "type": "object",
        "properties": {
          "pi": {
            "type": "string",
            "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
            "description": "Entity ID (ULID format)",
            "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
          },
          "ver": {
            "type": "integer",
            "minimum": 0,
            "exclusiveMinimum": true,
            "description": "Entity version number",
            "example": 1
          },
          "cid": {
            "type": "string",
            "minLength": 1,
            "description": "Content Identifier (CID) - content-addressed hash",
            "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
          },
          "attestation_status": {
            "type": "string",
            "enum": [
              "pending"
            ],
            "description": "Attestation upload status"
          },
          "message": {
            "type": "string",
            "description": "Status message",
            "example": "Attestation upload in progress"
          }
        },
        "required": [
          "pi",
          "ver",
          "cid",
          "attestation_status",
          "message"
        ]
      },
      "ChainHeadResponse": {
        "type": "object",
        "properties": {
          "seq": {
            "type": "integer",
            "description": "Sequence number of the latest attestation",
            "example": 784
          },
          "tx": {
            "type": "string",
            "description": "Arweave transaction ID",
            "example": "Rxv_BpobNBUr0x5DstsAEUVxCO12hKxv7cnHnGLYp2c"
          },
          "arweave_url": {
            "type": "string",
            "format": "uri",
            "description": "Arweave gateway URL for direct access",
            "example": "https://arweave.net/Rxv_BpobNBUr0x5DstsAEUVxCO12hKxv7cnHnGLYp2c"
          }
        },
        "required": [
          "seq",
          "tx",
          "arweave_url"
        ]
      },
      "VerifyAttestationResponse": {
        "type": "object",
        "properties": {
          "arweave_tx": {
            "type": "string"
          },
          "attestation": {
            "type": "object",
            "properties": {
              "pi": {
                "type": "string",
                "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
                "description": "Entity ID (ULID format)",
                "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
              },
              "ver": {
                "type": "integer",
                "minimum": 0,
                "exclusiveMinimum": true,
                "description": "Entity version number",
                "example": 1
              },
              "cid": {
                "type": "string",
                "minLength": 1,
                "description": "Content Identifier (CID) - content-addressed hash",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              },
              "op": {
                "type": "string",
                "enum": [
                  "C",
                  "U"
                ],
                "description": "Operation type: C=Create, U=Update"
              },
              "vis": {
                "type": "string",
                "enum": [
                  "pub",
                  "priv"
                ],
                "description": "Visibility at time of operation"
              },
              "prev_cid": {
                "type": "string",
                "nullable": true,
                "minLength": 1,
                "description": "Previous version CID (null for creates)",
                "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
              },
              "ts": {
                "type": "number",
                "description": "Unix timestamp (milliseconds)"
              }
            },
            "required": [
              "pi",
              "ver",
              "cid",
              "op",
              "vis",
              "prev_cid",
              "ts"
            ]
          },
          "cid_valid": {
            "type": "boolean",
            "description": "True if hash(manifest) matches the attested CID"
          },
          "manifest_preview": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Entity type",
                "example": "collection"
              }
            },
            "required": [
              "type"
            ],
            "description": "Truncated preview of the manifest content"
          }
        },
        "required": [
          "arweave_tx",
          "attestation",
          "cid_valid",
          "manifest_preview"
        ]
      }
    }
  },
  "x-arke-version": "1.0.0",
  "paths": {
    "/ops-reference": {
      "get": {
        "tags": [
          "Documentation"
        ],
        "summary": "Get LLM-friendly API reference",
        "description": "Returns a condensed, plain-text API operations reference optimized for LLM consumption.\n\nThis endpoint provides the same information as the OpenAPI spec but in a format that:\n- Uses ~80% fewer tokens than the full OpenAPI JSON\n- Preserves full endpoint descriptions\n- Organizes operations by category\n- Marks required fields with `*` suffix\n- Includes auth requirements inline\n\n**Format example:**\n```\n## Collections\nPOST /collections [required] - Create a new collection\n  body: {label*:string, description:string}\n\n  Creates a collection with the authenticated user as owner.\n```\n\nUse this for injecting API knowledge into LLM system prompts.",
        "responses": {
          "200": {
            "description": "Condensed API operations reference",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string",
                  "example": "# Arke API Operations Reference\n\n## Auth & Users\nPOST /auth/register [jwt-only] - Register new user\n..."
                }
              }
            }
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Register new user",
        "description": "Creates a user entity from JWT claims. Idempotent - returns existing user if already registered.\n\n---\n**Permission:** `user:create`  \n**Auth:** jwt-only",
        "x-arke-action": "user:create",
        "x-arke-auth": "jwt-only",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User already exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterResponse"
                }
              }
            }
          },
          "201": {
            "description": "User created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    "/users/me": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get current user",
        "description": "Returns the authenticated user's entity.\n\n---\n**Permission:** `user:view`  \n**Auth:** required",
        "x-arke-action": "user:view",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "500": {
            "description": "User entity not found (database inconsistency)"
          }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get user by ID",
        "description": "Returns a user entity by ID. May require authentication depending on permissions.\n\n---\n**Permission:** `user:view`  \n**Auth:** optional",
        "x-arke-action": "user:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "User found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Update user profile",
        "description": "Updates a user's profile. Requires user:update permission (typically self-ownership).\n\n---\n**Permission:** `user:update`  \n**Auth:** required",
        "x-arke-action": "user:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserUpdateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserUpdateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users/me/keys": {
      "post": {
        "tags": [
          "Users",
          "API Keys"
        ],
        "summary": "Create API key",
        "description": "Creates a new API key for the authenticated user. The full key is only returned once - store it securely.\n\n---\n**Permission:** `user:credentials`  \n**Auth:** required",
        "x-arke-action": "user:credentials",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateApiKeyRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "API key created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateApiKeyResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Users",
          "API Keys"
        ],
        "summary": "List API keys",
        "description": "Lists all active API keys for the authenticated user. Returns prefixes only, not full keys.\n\n---\n**Permission:** `user:credentials`  \n**Auth:** required",
        "x-arke-action": "user:credentials",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "API keys list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListApiKeysResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          }
        }
      }
    },
    "/users/me/keys/{prefix}": {
      "delete": {
        "tags": [
          "Users",
          "API Keys"
        ],
        "summary": "Revoke API key",
        "description": "Revokes an API key by prefix. The key will be immediately invalid.\n\n---\n**Permission:** `user:credentials`  \n**Auth:** required",
        "x-arke-action": "user:credentials",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 4,
              "maxLength": 12,
              "description": "API key prefix (e.g., uk_xKj9)",
              "example": "uk_xKj9"
            },
            "required": true,
            "name": "prefix",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "API key revoked"
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/collections": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "List collections user has access to",
        "description": "Returns all collections where the user has a role relationship (owner, editor, viewer, etc.).\n\nQueries GraphDB for collections with relationships pointing to this user where peer_type is 'user'.\nResults include the role predicate so clients know what access the user has to each collection.\n\nSupports filtering by predicate (role name) and pagination.\n\n---\n**Permission:** `user:view`  \n**Auth:** optional",
        "x-arke-action": "user:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "external",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "Filter by role predicate (e.g., owner, editor)",
              "example": "owner"
            },
            "required": false,
            "name": "predicate",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "Maximum number of results (default: 100, max: 1000)",
              "example": "100"
            },
            "required": false,
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "Pagination offset",
              "example": "0"
            },
            "required": false,
            "name": "offset",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "List of collections",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserCollectionsResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "503": {
            "description": "GraphDB service unavailable"
          }
        }
      }
    },
    "/users/me/search": {
      "post": {
        "tags": [
          "Users",
          "Search"
        ],
        "summary": "Search across user collections",
        "description": "Performs semantic search across all collections the authenticated user has access to.\n\n## Features\n- Searches all user's collections in parallel (up to 25)\n- Optionally includes public-domain entities\n- Filter by entity type or collection role\n- Results ranked by semantic relevance\n\n## Performance\n- Collections are queried in parallel for speed\n- If user has more than 25 collections, queries first 25 (by created_at). Use role filter to narrow down.\n- Response includes metadata showing collections_queried vs collections_total\n\n## Scoring\n- Results use cosine similarity scores (0-1)\n- Scores are comparable across collections\n\n\n---\n**Permission:** `search:execute`  \n**Auth:** required",
        "x-arke-action": "search:execute",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CrossCollectionSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CrossCollectionSearchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "503": {
            "description": "Search service unavailable"
          }
        }
      }
    },
    "/collections": {
      "post": {
        "tags": [
          "Collections"
        ],
        "summary": "Create a new collection",
        "description": "Creates a collection with the authenticated user as owner.\n\n---\n**Permission:** `collection:create`  \n**Auth:** required",
        "x-arke-action": "collection:create",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCollectionRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Collection created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}": {
      "get": {
        "tags": [
          "Collections"
        ],
        "summary": "Get collection by ID",
        "description": "Returns a collection entity by ID.\n\n---\n**Permission:** `collection:view`  \n**Auth:** optional",
        "x-arke-action": "collection:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Collection found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Collections"
        ],
        "summary": "Update collection properties",
        "description": "Updates collection properties. Requires collection:update permission.\n\n---\n**Permission:** `collection:update`  \n**Auth:** required",
        "x-arke-action": "collection:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCollectionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Collection updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionUpdateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/roles": {
      "post": {
        "tags": [
          "Collections"
        ],
        "summary": "Add a new role",
        "description": "Adds a new role to the collection. Requires collection:manage permission.\n\n---\n**Permission:** `collection:manage`  \n**Auth:** required",
        "x-arke-action": "collection:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddRoleRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Role added",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/roles/{role}": {
      "put": {
        "tags": [
          "Collections"
        ],
        "summary": "Update role actions",
        "description": "Updates the actions for an existing role. Requires collection:manage permission.\n\n---\n**Permission:** `collection:manage`  \n**Auth:** required",
        "x-arke-action": "collection:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "maxLength": 50,
              "example": "harpooner"
            },
            "required": true,
            "description": "Role name",
            "name": "role",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRoleRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Role updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Collections"
        ],
        "summary": "Delete a role",
        "description": "Deletes a role from the collection. Requires collection:manage permission.\n\n---\n**Permission:** `collection:manage`  \n**Auth:** required",
        "x-arke-action": "collection:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "maxLength": 50,
              "example": "harpooner"
            },
            "required": true,
            "description": "Role name",
            "name": "role",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Role deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoleResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/members": {
      "get": {
        "tags": [
          "Collections"
        ],
        "summary": "List collection members",
        "description": "Returns all members of the collection grouped by type. By default, expired memberships are excluded.\n\n---\n**Permission:** `collection:view`  \n**Auth:** optional",
        "x-arke-action": "collection:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "true",
                "false"
              ],
              "default": "false",
              "description": "Include expired memberships in response"
            },
            "required": false,
            "name": "include_expired",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Members list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MembersResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Collections"
        ],
        "summary": "Assign user to role",
        "description": "Assigns a user to a role in the collection. Requires collection:manage permission.\n\n---\n**Permission:** `collection:manage`  \n**Auth:** required",
        "x-arke-action": "collection:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AssignRoleRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User assigned to role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MemberAssignResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/members/{userId}": {
      "delete": {
        "tags": [
          "Collections"
        ],
        "summary": "Remove user from role",
        "description": "Removes a user from a role in the collection. Requires collection:manage permission.\n\n---\n**Permission:** `collection:manage`  \n**Auth:** required",
        "x-arke-action": "collection:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01JQ3EQ3EG000000000000000"
            },
            "required": true,
            "description": "User entity ID (ULID)",
            "name": "userId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "example": "crew"
            },
            "required": true,
            "description": "Role to remove user from",
            "name": "role",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "User removed from role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MemberRemoveResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/root": {
      "put": {
        "tags": [
          "Collections"
        ],
        "summary": "Set root entity",
        "description": "Links an entity as the root of this collection.\n\n**Prerequisites:** The entity must already have a 'collection' relationship\npointing to this collection (typically set during entity creation via the\n`collection` field).\n\n**Recommended flow:**\n1. Create entity with `collection` field set  entity is immediately protected\n2. Call this endpoint to establish the root link from collection to entity\n\nThis adds only the reverse relationship:\n- Collection  Entity (predicate: 'root')\n\nRequires collection:update permission on the collection.\n\n---\n**Permission:** `collection:update`  \n**Auth:** required",
        "x-arke-action": "collection:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SetRootEntityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Root entity set",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SetRootEntityResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/collections/{id}/entities": {
      "get": {
        "tags": [
          "Collections"
        ],
        "summary": "List entities in a collection",
        "description": "Returns entities belonging to this collection from the graph database.\n\nSupports pagination and optional type filtering. Results are ordered by creation date (newest first).\n\n---\n**Permission:** `collection:view`  \n**Auth:** optional",
        "x-arke-action": "collection:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "external",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "Filter entities by type",
              "example": "document"
            },
            "required": false,
            "name": "type",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10000,
              "default": 1000,
              "description": "Maximum number of entities to return",
              "example": 100
            },
            "required": false,
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "nullable": true,
              "minimum": 0,
              "default": 0,
              "description": "Number of entities to skip",
              "example": 0
            },
            "required": false,
            "name": "offset",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Entities in collection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionEntitiesResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "503": {
            "description": "GraphDB service unavailable"
          }
        }
      }
    },
    "/entities": {
      "post": {
        "tags": [
          "Entities"
        ],
        "summary": "Create a new entity",
        "description": "Creates a generic entity of any type. For type-specific validation, use type-specific endpoints.\n\n---\n**Permission:** `entity:create`  \n**Auth:** required",
        "x-arke-action": "entity:create",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEntityRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Entity created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityCreatedResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}": {
      "get": {
        "tags": [
          "Entities"
        ],
        "summary": "Get entity by ID",
        "description": "Returns any entity by ID. Permission check uses parent collection if entity belongs to one.\n\n**Relationship Expansion:**\n\nUse the `expand=relationships[:mode]` query parameter to hydrate relationship peer data:\n\n- **No expansion (default)**: Returns relationships with stored `peer_label`/`peer_type` (may be stale)\n  ```json\n  { \"predicate\": \"contains\", \"peer\": \"01KDOC...\", \"peer_label\": \"Old Label\" }\n  ```\n\n- **`?expand=relationships:preview`**: Adds `peer_preview` with fresh lightweight data (id, type, label, truncated description/text, timestamps)\n  ```json\n  {\n    \"predicate\": \"contains\",\n    \"peer\": \"01KDOC...\",\n    \"peer_label\": \"Old Label\",\n    \"peer_preview\": {\n      \"id\": \"01KDOC...\",\n      \"type\": \"document\",\n      \"label\": \"Updated Label\",\n      \"description_preview\": \"This is a document with...\",\n      \"created_at\": \"2025-01-15T10:00:00Z\",\n      \"updated_at\": \"2025-01-20T14:30:00Z\"\n    }\n  }\n  ```\n\n- **`?expand=relationships:full`**: Adds `peer_entity` with complete entity manifest (all properties, relationships, version history)\n  ```json\n  {\n    \"predicate\": \"contains\",\n    \"peer\": \"01KDOC...\",\n    \"peer_label\": \"Old Label\",\n    \"peer_entity\": {\n      \"id\": \"01KDOC...\",\n      \"cid\": \"bafyrei...\",\n      \"type\": \"document\",\n      \"properties\": { \"label\": \"Updated Label\", \"text\": \"...\" },\n      \"relationships\": [...],\n      \"ver\": 3,\n      \"created_at\": \"2025-01-15T10:00:00Z\",\n      \"ts\": 1737380000000,\n      \"edited_by\": { \"user_id\": \"01JUSER...\", \"method\": \"manual\" }\n    }\n  }\n  ```\n\n**Performance:** Preview expansion is recommended for most use cases. Full expansion with many large entities can result in multi-MB payloads.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "example": "relationships:preview"
            },
            "required": false,
            "description": "Comma-separated list of fields to expand. Supports: relationships[:preview|full]",
            "name": "expand",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Entity found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Entities"
        ],
        "summary": "Update entity",
        "description": "Updates an entity with merge semantics. **This is the recommended way to manage relationships.**\n\n- `relationships_add`: Upsert relationships (properties are merged if relationship exists)\n- `relationships_remove`: Remove by predicate/peer\n- `properties`: Deep merged with existing\n- `properties_remove`: Remove nested properties using nested object structure\n\n**properties_remove syntax:**\n- Top-level keys: `[\"field1\", \"field2\"]`\n- Nested keys: `{ parent: { child: [\"key_to_remove\"] } }`\n- **Dot notation is NOT supported** - `[\"parent.child.key\"]` will NOT work\n\nExample to remove `config.options.debug`:\n```json\n{ \"properties_remove\": { \"config\": { \"options\": [\"debug\"] } } }\n```\n\nUse `/relationships` only for bidirectional links updating two entities atomically.\n\nNote: entity:update on a collection requires collection:update permission.\n\n---\n**Permission:** `entity:update`  \n**Auth:** required",
        "x-arke-action": "entity:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateEntityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Entity updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityUpdatedResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Entities"
        ],
        "summary": "Delete entity",
        "description": "Soft-deletes an entity by creating a tombstone version. The entity can be restored later via POST /entities/:id/restore. Note: entity:delete on a collection requires collection:delete permission.\n\n---\n**Permission:** `entity:delete`  \n**Auth:** required",
        "x-arke-action": "entity:delete",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteEntityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Entity deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityDeletedResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/preview": {
      "get": {
        "tags": [
          "Entities"
        ],
        "summary": "Get entity preview",
        "description": "Returns lightweight preview data for an entity. Useful for:\n- Link previews and hover cards\n- Relationship metadata freshness (vs stale peer_label)\n- AI context management (smaller payloads)\n- Search result enhancement\n\nReturns: id, type, label, collection_pi, description_preview (200 chars), text_preview (200 chars), timestamps.\n\n**Performance:** Single KV fetch, ~40-60ms response time, typically <1KB payload.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Entity preview data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityPreview"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/tip": {
      "get": {
        "tags": [
          "Entities"
        ],
        "summary": "Get entity tip CID",
        "description": "Returns only the current manifest CID (tip) for an entity. Lightweight endpoint for CAS operations - single Durable Object lookup, no manifest fetch, no permission check.\n\n---\n**Permission:** `entity:tip`  \n**Auth:** none",
        "x-arke-action": "entity:tip",
        "x-arke-auth": "none",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Tip found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TipResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/cascade": {
      "delete": {
        "tags": [
          "Entities"
        ],
        "summary": "Cascade delete entity and related entities",
        "description": "Deletes an entity and all related entities matching predicate patterns within a scoped collection.\n\n**Permission Model:**\n- Requires `entity:delete` permission on the specified `collection_id`\n- Single permission check at the start (not per-entity)\n- Individual entity type permissions are NOT checked during cascade\n\n**Cascade Rules:**\n- `collection` predicate NEVER cascades (hard rule - protects collection structure)\n- Only entities in the specified collection are deleted\n- Entities outside the collection are skipped (reported in `skipped` array)\n\n**Predicate Patterns:**\n- `\"child\"` - exact match only\n- `\"has_*\"` - matches has_document, has_image, etc.\n- `\"*_copy\"` - matches file_copy, document_copy, etc.\n- `\"*\"` - matches ALL predicates (except collection)\n\n**Traversal:**\n- BFS traversal with parallel processing per depth layer\n- Max depth: 20 (default: 10)\n- Optional `edited_by_filter` to only delete entities created by a specific actor (useful for agent cleanup)\n\n**CAS Handling:**\n- Root entity uses the provided `expect_tip`\n- Child entities use re-fetch + single retry strategy\n- CAS conflicts are reported as skipped (not failures)\n\n**Response:**\n- Lists all deleted entities with their depth from root\n- Lists skipped entities with reasons\n- Provides summary statistics\n\n---\n**Permission:** `entity:delete`  \n**Auth:** required",
        "x-arke-action": "entity:delete",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CascadeDeleteRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Cascade delete completed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CascadeDeleteResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/restore": {
      "post": {
        "tags": [
          "Entities"
        ],
        "summary": "Restore deleted entity",
        "description": "Restores a deleted entity by finding the last non-deleted version and creating a new version from it. Note: entity:restore on a collection requires collection:restore permission.\n\n---\n**Permission:** `entity:restore`  \n**Auth:** required",
        "x-arke-action": "entity:restore",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RestoreEntityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Entity restored",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityRestoredResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/collection": {
      "get": {
        "tags": [
          "Entities"
        ],
        "summary": "Get entity collection",
        "description": "Returns the collection ID that this entity belongs to. Returns null if the entity is not in any collection. If the entity IS a collection, returns its own ID.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Collection lookup result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityCollectionResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/tree": {
      "get": {
        "tags": [
          "Entities"
        ],
        "summary": "Get entity tree",
        "description": "Returns a hierarchical tree of entities reachable from the source entity.\n\nUse this to browse collections and folders without making multiple API calls.\nThe tree follows relationship edges (optionally filtered by predicate) and\nreturns a nested structure suitable for tree UI rendering.\n\nQuery parameters:\n- `depth`: Max tree depth (1-4, default 2)\n- `collection`: Constrain to entities in this collection\n- `predicates`: Comma-separated predicates to follow (e.g., \"contains\")\n- `limit`: Max nodes to return (default 100)\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4,
              "default": 2,
              "description": "Maximum tree depth (1-4)",
              "example": 2
            },
            "required": false,
            "name": "depth",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Constrain results to entities in this collection",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": false,
            "name": "collection",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "Comma-separated predicates to follow (e.g., \"contains,references\")",
              "example": "contains"
            },
            "required": false,
            "name": "predicates",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "default": 100,
              "description": "Maximum number of nodes to return",
              "example": 100
            },
            "required": false,
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Tree retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TreeResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/diff": {
      "get": {
        "tags": [
          "Entities",
          "Versions"
        ],
        "summary": "Get diff between entity versions",
        "description": "Computes the difference between two versions of an entity.\n\nQuery parameters:\n- `from`: CID of the \"from\" version (defaults to prev of \"to\" version)\n- `to`: CID of the \"to\" version (defaults to current tip)\n- `format`: Output format - \"semantic\" (default) or \"patch\" (RFC 6902)\n\nModes:\n- No params: Compare current tip with its previous version\n- `to` only: Compare that version with its prev\n- `from` only: Compare from that version to current tip\n- Both: Compare any two versions\n\nFor version 1 entities (no previous version), \"from\" is null and all content appears as added.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "description": "Content Identifier (CID) - content-addressed hash",
              "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
            },
            "required": false,
            "description": "CID of the \"from\" version. Defaults to prev of \"to\" version.",
            "name": "from",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "description": "Content Identifier (CID) - content-addressed hash",
              "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
            },
            "required": false,
            "description": "CID of the \"to\" version. Defaults to current tip.",
            "name": "to",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "semantic",
                "patch"
              ],
              "default": "semantic"
            },
            "required": false,
            "description": "Output format: \"semantic\" (default) or \"patch\" (RFC 6902)",
            "name": "format",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Diff computed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiffResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/permissions": {
      "get": {
        "tags": [
          "Entities",
          "Permissions"
        ],
        "summary": "Get your permissions for an entity",
        "description": "Returns the list of actions you can perform on this entity.\n\nThe response includes:\n- `allowed_actions`: Concrete actions you can perform (no wildcards)\n- `resolution`: How permissions were determined\n\nResolution methods:\n- `collection`: Permissions from your role in the parent collection\n- `self`: You are checking your own user entity (self-ownership)\n- `open_season`: Entity is not in any collection (publicly accessible)\n\nActions are filtered to only those relevant to the entity type:\n- For files: entity:* and file:* actions\n- For collections: entity:* and collection:* actions\n- etc.\n\n---\n**Permission:** `entity:view`  \n**Auth:** required",
        "x-arke-action": "entity:view",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Permissions retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EntityPermissionsResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/relationships": {
      "post": {
        "tags": [
          "Relationships"
        ],
        "summary": "Add relationship between entities",
        "description": "Creates a relationship from source to target entity.\n\n** For single-entity updates, prefer `PUT /entities/:id` with `relationships_add` - simpler API, one CAS guard, can update properties too.**\n\nUse this endpoint only for **bidirectional** relationships requiring atomic updates to TWO entities.\n\nIf `target_predicate` is provided (bidirectional):\n- Updates both source and target entities\n- Requires `entity:update` on both, plus two CAS guards\n\nIf `target_predicate` is omitted (unidirectional):\n- Use `PUT /entities/:id` instead\n\n---\n**Permission:** `entity:update`  \n**Auth:** required",
        "x-arke-action": "entity:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddRelationshipRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Relationship created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AddRelationshipResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Relationships"
        ],
        "summary": "Remove relationship between entities",
        "description": "Removes a relationship from source to target entity.\n\n** For single-entity updates, prefer `PUT /entities/:id` with `relationships_remove` - simpler API, one CAS guard, can update properties too.**\n\nUse this endpoint only for **bidirectional** relationships requiring atomic updates to TWO entities.\n\nIf `target_predicate` is provided (bidirectional):\n- Updates both source and target entities\n- Requires `entity:update` on both, plus two CAS guards\n\nIf `target_predicate` is omitted (unidirectional):\n- Use `PUT /entities/:id` instead\n\n---\n**Permission:** `entity:update`  \n**Auth:** required",
        "x-arke-action": "entity:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RemoveRelationshipRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Relationship removed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RemoveRelationshipResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/connect": {
      "post": {
        "tags": [
          "Connect"
        ],
        "summary": "Connect two entities",
        "description": "Creates a unidirectional relationship from source to target entity.\n\nThis is a shorthand for adding a relationship with sensible defaults:\n- Default predicate: `connects_to` (customizable)\n- Optional label and description stored in relationship properties\n- Only requires `entity:update` permission on source entity\n\nUse this for simple entity linking. For bidirectional relationships or\nadvanced options, use the `/relationships` endpoint.\n\n---\n**Permission:** `entity:update`  \n**Auth:** required",
        "x-arke-action": "entity:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConnectRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Connection created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConnectResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/connect/disconnect": {
      "post": {
        "tags": [
          "Connect"
        ],
        "summary": "Disconnect two entities",
        "description": "Removes a unidirectional relationship from source to target entity.\n\nThis is a shorthand for removing a relationship:\n- Default predicate: `connects_to` (customizable)\n- Only requires `entity:update` permission on source entity\n\nFor bidirectional removal, use the `/relationships` endpoint.\n\n---\n**Permission:** `entity:update`  \n**Auth:** required",
        "x-arke-action": "entity:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DisconnectRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connection removed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DisconnectResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/files": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "Create file entity",
        "description": "Creates a new file entity.\n\n## Flow\n1. Call this endpoint with file metadata (key, filename, content_type, size)\n2. Receive entity data (uploaded: false)\n3. POST the file content to /{id}/content\n4. Entity will be updated with uploaded: true and verified CID\n\n## Key Best Practice\nUse a unique identifier as the key (e.g., version number, timestamp).\nThe actual CID is computed during upload.\n\n---\n**Permission:** `file:create`  \n**Auth:** required",
        "x-arke-action": "file:create",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateFileRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "File entity created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateFileResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    "/files/{id}": {
      "get": {
        "tags": [
          "Files"
        ],
        "summary": "Get file metadata",
        "description": "Returns file entity metadata. Use /{id}/content to download the file content.\n\n---\n**Permission:** `file:view`  \n**Auth:** optional",
        "x-arke-action": "file:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "File found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Files"
        ],
        "summary": "Update file metadata",
        "description": "Updates file metadata without changing the file content.\n\n## Key Changes\nThe key can be changed, but ONLY to a key that already exists in R2.\nThis allows \"regressing\" to a previous file version.\n\nTo upload a new file, use POST /{id}/reupload instead.\n\n---\n**Permission:** `file:update`  \n**Auth:** required",
        "x-arke-action": "file:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateFileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateFileResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/files/{id}/content": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "Upload file content",
        "description": "Uploads the binary content for a file entity.\n\n## Request\n- Content-Type: The MIME type of the file (must match entity's content_type)\n- Body: Binary file content (streaming supported)\n\n## Limits\n- Maximum file size: 500 MB\n\n## Behavior\n- Streams content directly to R2\n- Computes CID from file bytes\n- Updates entity with uploaded: true, verified size, and computed CID\n- Atomic operation - either fully succeeds or fails\n\n## Idempotency\nRe-uploading content for an already-uploaded file will fail with 409 Conflict.\nUse POST /{id}/reupload first to create a new version.\n\n---\n**Permission:** `file:upload`  \n**Auth:** required",
        "x-arke-action": "file:upload",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "File content uploaded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UploadContentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          },
          "413": {
            "description": "File too large (max 500 MB)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Files"
        ],
        "summary": "Download file content",
        "description": "Downloads the binary content of a file entity.\n\n## Response Headers\n- Content-Type: The MIME type of the file\n- Content-Length: File size in bytes\n- Content-Disposition: attachment; filename=\"original_filename\"\n\n## Streaming\nResponse is streamed directly from R2 storage.\n\n---\n**Permission:** `file:download`  \n**Auth:** optional",
        "x-arke-action": "file:download",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "File content",
            "content": {
              "application/octet-stream": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/files/{id}/reupload": {
      "post": {
        "tags": [
          "Files"
        ],
        "summary": "Prepare for new file version",
        "description": "Prepares the entity for uploading a new file version.\n\n## Flow\n1. Call this endpoint with new key and file metadata\n2. Receive updated entity (uploaded: false)\n3. POST the new file content to /{id}/content\n4. Entity will be updated with uploaded: true and verified CID\n\n## Key Requirement\nThe new key must NOT already exist in R2 (no overwrites).\nPrevious file versions remain accessible via manifest history.\n\n---\n**Permission:** `file:reupload`  \n**Auth:** required",
        "x-arke-action": "file:reupload",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReuploadFileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ready for new file version upload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReuploadFileResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders": {
      "post": {
        "tags": [
          "Folders"
        ],
        "summary": "Create folder",
        "description": "Creates a new folder entity. Optionally sets parent for immediate hierarchy.\n\nIf a parent folder is specified, a bidirectional relationship is created:\n- Parent folder contains this folder\n- This folder is in parent folder\n\n---\n**Permission:** `folder:create`  \n**Auth:** required",
        "x-arke-action": "folder:create",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateFolderRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Folder created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateFolderResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}": {
      "get": {
        "tags": [
          "Folders"
        ],
        "summary": "Get folder",
        "description": "Returns folder metadata including children and parent relationships.\n\n---\n**Permission:** `folder:view`  \n**Auth:** optional",
        "x-arke-action": "folder:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Folder found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FolderResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Folders"
        ],
        "summary": "Update folder",
        "description": "Updates folder properties (label, description, metadata). Properties are merged.\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateFolderRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Folder updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateFolderResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}/children": {
      "post": {
        "tags": [
          "Folders"
        ],
        "summary": "Add child to folder",
        "description": "Adds a child entity (file or folder) to this folder.\n\nCreates bidirectional relationship:\n- Folder contains child\n- Child is in folder\n\n**Idempotent**: if relationship already exists, returns current state without error.\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddChildRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Child added",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AddChildResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}/children/{childId}": {
      "delete": {
        "tags": [
          "Folders"
        ],
        "summary": "Remove child from folder",
        "description": "Removes a child entity from this folder (bidirectional).\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01JFILE456ABCDEFGHJKMNPQRS"
            },
            "required": true,
            "description": "Child entity ID",
            "name": "childId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RemoveChildRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Child removed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RemoveChildResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}/children/bulk": {
      "post": {
        "tags": [
          "Folders"
        ],
        "summary": "Bulk add children to folder",
        "description": "Efficiently adds multiple children to a folder.\n\n**Limit**: Maximum 50 children per request. For larger batches, make multiple\nrequests, refetching the folder's CID between each to satisfy the CAS guard.\n\n**Strategy**:\n1. Updates folder once with all 'contains' relationships\n2. Updates each child in parallel with 'in' back-link\n\n**Idempotent**: skips children that already have the relationship.\nReturns both added and skipped children in the response.\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BulkAddChildrenRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Children added",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BulkAddChildrenResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}/parents": {
      "post": {
        "tags": [
          "Folders"
        ],
        "summary": "Add parent to folder",
        "description": "Adds this folder to a parent folder.\n\nCreates bidirectional relationship:\n- Parent contains this folder\n- This folder is in parent\n\n**Idempotent**: if relationship already exists, returns current state without error.\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddParentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Parent added",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AddParentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/folders/{id}/parents/{parentId}": {
      "delete": {
        "tags": [
          "Folders"
        ],
        "summary": "Remove parent from folder",
        "description": "Removes this folder from a parent folder (bidirectional).\n\n---\n**Permission:** `folder:update`  \n**Auth:** required",
        "x-arke-action": "folder:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01JPARENT78ABCDEFGHJKMNPQR"
            },
            "required": true,
            "description": "Parent folder ID",
            "name": "parentId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RemoveParentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Parent removed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RemoveParentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/versions/{id}": {
      "get": {
        "tags": [
          "Versions"
        ],
        "summary": "List version history",
        "description": "Returns version metadata for an entity (newest first). Use pagination for entities with many versions.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "default": 10,
              "example": 10
            },
            "required": false,
            "description": "Maximum versions to return (1-10, default 10)",
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "description": "Content Identifier (CID) - content-addressed hash",
              "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
            },
            "required": false,
            "description": "CID to start from (for pagination)",
            "name": "from",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Version list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/VersionListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/versions/manifest/{cid}": {
      "get": {
        "tags": [
          "Versions"
        ],
        "summary": "Get manifest by CID",
        "description": "Returns the full manifest for any version by its CID. Permission is checked against the entity ID in the manifest.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "description": "Content Identifier (CID) - content-addressed hash",
              "example": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy"
            },
            "required": true,
            "description": "IPFS Content Identifier (CID) of the manifest",
            "name": "cid",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Manifest found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ManifestResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/permissions": {
      "get": {
        "tags": [
          "Permissions"
        ],
        "summary": "Get permission system metadata",
        "description": "Returns all registered actions, verbs, types, verb implications, wildcard patterns, and default roles.\n\nThis endpoint is useful for:\n- Building dynamic role editors\n- Understanding available permissions\n- Validating actions client-side\n\nAll data is auto-generated from the actual permission system, so it's always in sync with the code.\n\n---\n**Permission:** `permissions:read`  \n**Auth:** none",
        "x-arke-action": "permissions:read",
        "x-arke-auth": "none",
        "x-arke-tier": "standard",
        "responses": {
          "200": {
            "description": "Permission system metadata",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PermissionsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/agents": {
      "post": {
        "tags": [
          "Agents"
        ],
        "summary": "Create an agent",
        "description": "Creates a new agent entity. Requires agent:create permission in the target collection.\n\n---\n**Permission:** `agent:create`  \n**Auth:** required",
        "x-arke-action": "agent:create",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAgentRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Agent created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/agents/{id}": {
      "get": {
        "tags": [
          "Agents"
        ],
        "summary": "Get agent by ID",
        "description": "Returns an agent entity by ID.\n\n---\n**Permission:** `agent:view`  \n**Auth:** optional",
        "x-arke-action": "agent:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Agent found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Agents"
        ],
        "summary": "Update agent",
        "description": "Updates an agent. Requires agent:update permission.\n\n**Field placement:** Agent-specific fields (`label`, `endpoint`, `actions_required`, `input_schema`, etc.) must be at the root level, NOT inside `properties`. The `properties` bag is for additional custom data only.\n\n**properties_remove syntax:** Use nested objects, not dot notation.\n- Correct: `{ \"input_schema\": { \"properties\": [\"field_to_remove\"] } }`\n- Wrong: `[\"input_schema.properties.field_to_remove\"]`\n\n---\n**Permission:** `agent:update`  \n**Auth:** required",
        "x-arke-action": "agent:update",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAgentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Agent updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentUpdateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - CAS validation failed (entity was modified)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CASErrorResponse"
                },
                "example": {
                  "error": "Conflict: entity was modified",
                  "details": {
                    "expected": "bafyreibug443cnd4endcwinwttw3c3dzmcl2ikht64xzn5qg56bix3usfy",
                    "actual": "bafyreinewabc123456789defghijklmnopqrstuvwxyz"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/agents/{id}/invoke": {
      "post": {
        "tags": [
          "Agents"
        ],
        "summary": "Invoke an agent",
        "description": "Invoke an agent to perform work on a target collection.\n\n**Note:** The `target` parameter must be a collection ID. Agents receive permissions scoped to collections, not individual entities. To process a specific entity, pass the collection it belongs to.\n\n**Two-phase interaction:**\n1. `confirm: false` (default) - preview permissions that will be granted\n2. `confirm: true` - execute the agent\n\nThe agent receives temporal (time-limited) permissions on the target collection.\n\n---\n**Permission:** `agent:invoke`  \n**Auth:** required",
        "x-arke-action": "agent:invoke",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InvokeAgentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invoke preview (confirm: false) or execution started (confirm: true)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvokePreviewResponse"
                }
              }
            }
          },
          "202": {
            "description": "Agent execution started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InvokeConfirmedResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/agents/{id}/keys": {
      "post": {
        "tags": [
          "Agents"
        ],
        "summary": "Create API key for agent",
        "description": "Creates an API key for the agent. The full key is only returned once.\n\n---\n**Permission:** `agent:manage`  \n**Auth:** required",
        "x-arke-action": "agent:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAgentApiKeyRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "API key created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateAgentApiKeyResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Agents"
        ],
        "summary": "List API keys for agent",
        "description": "Lists all active API keys for the agent (without the actual key values).\n\n---\n**Permission:** `agent:manage`  \n**Auth:** required",
        "x-arke-action": "agent:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "API keys listed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListAgentApiKeysResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/agents/{id}/keys/{prefix}": {
      "delete": {
        "tags": [
          "Agents"
        ],
        "summary": "Revoke API key",
        "description": "Revokes an API key for the agent.\n\n---\n**Permission:** `agent:manage`  \n**Auth:** required",
        "x-arke-action": "agent:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 4,
              "maxLength": 12,
              "description": "API key prefix (e.g., ak_xKj9)",
              "example": "ak_xKj9"
            },
            "required": true,
            "name": "prefix",
            "in": "path"
          }
        ],
        "responses": {
          "204": {
            "description": "API key revoked"
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/agents/{id}/verify": {
      "post": {
        "tags": [
          "Agents"
        ],
        "summary": "Verify agent endpoint ownership",
        "description": "Verify that you control the agent's endpoint URL. This is required before activating an agent.\n\n**Two-phase flow:**\n1. Call without `confirm` to get a verification token\n2. Deploy `/.well-known/arke-verification` endpoint returning the token\n3. Call with `confirm: true` to complete verification\n\n**Verification endpoint format:**\nYour endpoint must return JSON:\n```json\n{\n  \"verification_token\": \"vt_xxx...\",\n  \"agent_id\": \"IIxxx...\"\n}\n```\n\n---\n**Permission:** `agent:manage`  \n**Auth:** required",
        "x-arke-action": "agent:manage",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VerifyAgentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Verification token (when confirm is false) or verification result (when confirm is true)",
            "content": {
              "application/json": {
                "schema": {
                  "anyOf": [
                    {
                      "$ref": "#/components/schemas/VerifyAgentTokenResponse"
                    },
                    {
                      "$ref": "#/components/schemas/VerifyAgentSuccessResponse"
                    },
                    {
                      "$ref": "#/components/schemas/VerifyAgentFailureResponse"
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/jobs/{id}": {
      "get": {
        "tags": [
          "Jobs"
        ],
        "summary": "Get job status",
        "description": "Returns focused job status and summary. Use this endpoint for quick status polling.\n\nReturns 404 if the entity is not a job collection.\n\n**Response includes:**\n- Current status (running/done/error)\n- Timestamps (started_at, completed_at)\n- Agent references (agent, main_agent, target)\n- Counts (files_count, sub_jobs_count)\n\n---\n**Permission:** `collection:view`  \n**Auth:** optional",
        "x-arke-action": "collection:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Job status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JobStatusResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/events": {
      "get": {
        "tags": [
          "Events"
        ],
        "summary": "List entity change events",
        "description": "Returns a cursor-based list of entity change events for client synchronization.\n\n**Usage:**\n- Call without cursor to get newest events\n- Use returned `cursor` as `?cursor=` to get older events\n- Poll without cursor periodically to check for new events\n\n**Sync flow:**\n1. Initial: `GET /events`  get newest, save highest `id` as high-water mark\n2. Paginate: `GET /events?cursor=X`  get older events until `has_more=false`\n3. Poll: `GET /events`  if newest `id` > high-water mark, process new events\n\n**Event data:**\n- `id`: Auto-increment ID\n- `pi`: Entity ID that changed\n- `cid`: New manifest CID\n- `ts`: ISO timestamp\n\nEvents are ephemeral (30-day rolling window) - for full sync, use snapshots.\n\n---\n**Permission:** `events:list`  \n**Auth:** none",
        "x-arke-action": "events:list",
        "x-arke-auth": "none",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "example": 12345
            },
            "required": false,
            "description": "Return events older than this id (from previous response cursor)",
            "name": "cursor",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "example": 100
            },
            "required": false,
            "description": "Maximum number of events to return (default: 100, max: 1000)",
            "name": "limit",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "main",
                "test"
              ],
              "example": "main"
            },
            "required": false,
            "description": "Network to query (default: main)",
            "name": "network",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Events list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EventsListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/graph/paths": {
      "post": {
        "tags": [
          "Graph"
        ],
        "summary": "Find paths between entities",
        "description": "Find shortest paths between source and target entity sets. Returns all paths up to the limit (default 100).\n\nUse this when you know both endpoints and want to discover how they connect - for example, finding the chain of relationships between a person and a document.\n\n---\n**Permission:** `graph:query`  \n**Auth:** required",
        "x-arke-action": "graph:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PathsBetweenRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Paths found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PathsBetweenResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/graph/reachable": {
      "post": {
        "tags": [
          "Graph"
        ],
        "summary": "Find reachable entities (exhaustive)",
        "description": "Find all entities of a specific type reachable from source entities within N hops. Returns up to 100 results by default.\n\n**When to use this vs POST /query:** This endpoint returns exhaustive, unranked results - all reachable entities up to the limit. Use `POST /query` when you want relevance-ranked results combining semantic similarity with graph structure. Use this endpoint when you need comprehensive graph exploration from known entity IDs.\n\n---\n**Permission:** `graph:query`  \n**Auth:** required",
        "x-arke-action": "graph:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PathsReachableRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reachable entities found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PathsReachableResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/graph/entity/{id}": {
      "get": {
        "tags": [
          "Graph"
        ],
        "summary": "Get entity from graph",
        "description": "Get entity details with all relationships from the graph database. Unlike the entity manifest, this includes both outgoing and incoming relationships - showing not just what this entity links to, but also what links to it.\n\n---\n**Permission:** `graph:query`  \n**Auth:** required",
        "x-arke-action": "graph:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Entity found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GraphEntityResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/query": {
      "post": {
        "tags": [
          "Query"
        ],
        "summary": "Execute Argo query",
        "description": "Execute an Argo DSL query for path-based graph traversal with relevance ranking.\n\n## When to Use This Endpoint\n\n| Endpoint | Use Case |\n|----------|----------|\n| `POST /query` | Semantic search + graph traversal with **relevance-ranked** results (default k=25) |\n| `POST /graph/reachable` | **Exhaustive** graph exploration from known entities (default limit=100) |\n| `POST /graph/paths` | Find all shortest paths between two entity sets |\n\nThis endpoint combines semantic similarity scores with path length to rank results. For exhaustive graph traversal without ranking, use the `/graph/*` endpoints directly.\n\n## Query Syntax\n\n```\n[SCOPE_PREFIX] ENTRY_POINT [ENTRY_FILTER] [-[RELATION]{DEPTH}-> TARGET_FILTER]...\n```\n\n## Scope Prefixes\n\nControl where semantic search looks for entry points. Default is discovery mode.\n\n| Prefix | Description | Example |\n|--------|-------------|---------|\n| (none) | **Discovery mode** (default) - find relevant collections, then search within each | `\"medical notes\"` |\n| `@:collections` | Search for collections themselves | `@:collections \"columbia archives\"` |\n| `@:collection(id)` | Search within a specific collection | `@:collection(01JCOLL123) \"meeting\"` |\n| `@:discover` | Explicit discovery mode | `@:discover \"research papers\"` |\n| `@:public` | Search public domain only | `@:public \"orphaned data\"` |\n\n**Note:** Graph traversal (hops) is always cross-collection regardless of scope.\n\n### Entry Points\n\n| Syntax | Description | Example |\n|--------|-------------|---------|\n| `\"text\"` | Semantic search | `\"george washington\"` |\n| `@id` | Exact entity ID | `@01KE4ZY69F9R40E88PK9S0TQRQ` |\n| `type:X` | All entities of type | `type:person` |\n| `type:X ~ \"text\"` | Semantic search within type | `type:person ~ \"physician\"` |\n\n### Edges (Hops)\n\n| Syntax | Direction |\n|--------|-----------|\n| `-[*]->` | Outgoing |\n| `<-[*]-` | Incoming |\n| `<-[*]->` | Both |\n| `-[*]{,4}->` | Variable depth (1-4) |\n\n### Examples\n\n```\n\"george washington\"                           # Discovery mode (default)\n@:collections \"columbia university\"           # Find collections\n@:collection(01JCOLL123) \"faculty meeting\"    # Within specific collection\n@:discover \"alice\" -[*]{,2}-> type:person     # Discover, then traverse\n@01KE4ZY... -[*]{,2}-> type:person            # From exact entity\n```\n\n\n---\n**Permission:** `query:execute`  \n**Auth:** required",
        "x-arke-action": "query:execute",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/QueryRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Query executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QueryResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/similar/collections": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Find similar collections",
        "description": "Find collections that are semantically similar to a given collection.\n\nUses the collection's weighted centroid vector (combination of description and entity embeddings) to find related collections.\n\n---\n**Permission:** `search:similar`  \n**Auth:** required",
        "x-arke-action": "search:similar",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "pi": {
                    "type": "string",
                    "description": "Collection PI to find similar collections for"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 10,
                    "description": "Maximum results to return"
                  },
                  "refresh": {
                    "type": "boolean",
                    "default": false,
                    "description": "Force fresh query, bypassing cache"
                  }
                },
                "required": [
                  "pi"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Similar collections found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "label",
                          "score"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "source_pi": {
                          "type": "string"
                        },
                        "result_count": {
                          "type": "number"
                        },
                        "cached": {
                          "type": "boolean"
                        },
                        "cached_at": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "source_pi",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/similar/items": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Find similar items across collections",
        "description": "Find entities that are semantically similar to a given entity, searching across multiple collections.\n\nThis performs a two-tier search:\n1. First finds collections similar to the entity's collection\n2. Then searches within each collection for similar items\n3. Aggregates and ranks results with diversity weighting\n\n---\n**Permission:** `search:similar`  \n**Auth:** required",
        "x-arke-action": "search:similar",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "pi": {
                    "type": "string",
                    "description": "Entity PI to find similar items for"
                  },
                  "collection_pi": {
                    "type": "string",
                    "description": "Entity's collection PI"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 20,
                    "description": "Maximum results to return"
                  },
                  "tier1_limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 50,
                    "default": 10,
                    "description": "Number of similar collections to search"
                  },
                  "tier2_limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 20,
                    "default": 5,
                    "description": "Items to fetch per collection"
                  },
                  "include_same_collection": {
                    "type": "boolean",
                    "default": true,
                    "description": "Include results from the same collection"
                  },
                  "refresh": {
                    "type": "boolean",
                    "default": false,
                    "description": "Force fresh query, bypassing cache"
                  }
                },
                "required": [
                  "pi",
                  "collection_pi"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Similar items found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "collection_pi": {
                            "type": "string",
                            "nullable": true
                          },
                          "score": {
                            "type": "number"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "type",
                          "label",
                          "collection_pi",
                          "score"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "source_pi": {
                          "type": "string"
                        },
                        "collections_searched": {
                          "type": "number"
                        },
                        "result_count": {
                          "type": "number"
                        },
                        "cached": {
                          "type": "boolean"
                        },
                        "cached_at": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "source_pi",
                        "collections_searched",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/collections": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Search collections by text",
        "description": "Search for collections using semantic text search.\n\nUse this endpoint to discover collections about a topic. Results are ranked by semantic similarity to your query.\n\n---\n**Permission:** `search:query`  \n**Auth:** required",
        "x-arke-action": "search:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Search query text"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 10,
                    "description": "Maximum results to return"
                  },
                  "types": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Filter by collection types"
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "label",
                          "type",
                          "score"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "query": {
                          "type": "string"
                        },
                        "result_count": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "query",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/agents": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Search agents by text",
        "description": "Search for agents using semantic text search.\n\nUse this endpoint to discover agents across the network. Only active agents are returned. Results are ranked by semantic similarity to your query based on agent descriptions and capabilities.\n\n---\n**Permission:** `search:query`  \n**Auth:** required",
        "x-arke-action": "search:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Search query text"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 10,
                    "description": "Maximum results to return"
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          },
                          "collection_pi": {
                            "type": "string",
                            "nullable": true
                          },
                          "status": {
                            "type": "string"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "label",
                          "score",
                          "collection_pi"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "query": {
                          "type": "string"
                        },
                        "result_count": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "query",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/entities": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Search entities within collection(s)",
        "description": "Search for entities within one or more collections using semantic text search.\n\nProvide either `collection_pi` for a single collection or `collection_pis` for multiple collections (searched in parallel).\n\nUse `per_collection_limit` to ensure result diversity when searching multiple collections.\n\n---\n**Permission:** `search:query`  \n**Auth:** required",
        "x-arke-action": "search:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "collection_pi": {
                    "type": "string",
                    "description": "Single collection PI to search within"
                  },
                  "collection_pis": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "maxItems": 20,
                    "description": "Multiple collection PIs to search (max 20)"
                  },
                  "query": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Search query text"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 20,
                    "description": "Maximum total results to return"
                  },
                  "types": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Filter by entity types"
                  },
                  "per_collection_limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 50,
                    "description": "Max results per collection for diversity"
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          },
                          "collection_pi": {
                            "type": "string"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "label",
                          "type",
                          "score",
                          "collection_pi"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "collection_pis": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "query": {
                          "type": "string"
                        },
                        "collections_searched": {
                          "type": "number"
                        },
                        "result_count": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "collection_pis",
                        "query",
                        "collections_searched",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/search/discover": {
      "post": {
        "tags": [
          "Search"
        ],
        "summary": "Discover entities across all collections",
        "description": "Two-step discovery search: first finds relevant collections, then searches within them.\n\nUse this endpoint when you don't know which collections to search. The system will:\n1. Find collections semantically related to your query\n2. Search within each collection in parallel\n3. Aggregate and rank results across all collections\n\nGreat for exploration and AI agents navigating the network.\n\n---\n**Permission:** `search:query`  \n**Auth:** required",
        "x-arke-action": "search:query",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500,
                    "description": "Search query text"
                  },
                  "limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 100,
                    "default": 20,
                    "description": "Maximum total results to return"
                  },
                  "types": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Filter by entity types"
                  },
                  "collection_limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 50,
                    "default": 10,
                    "description": "Number of collections to search"
                  },
                  "per_collection_limit": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 20,
                    "default": 5,
                    "description": "Max results per collection"
                  }
                },
                "required": [
                  "query"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Discovery results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "pi": {
                            "type": "string"
                          },
                          "label": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string"
                          },
                          "score": {
                            "type": "number"
                          },
                          "collection_pi": {
                            "type": "string"
                          },
                          "created_at": {
                            "type": "string"
                          },
                          "updated_at": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "pi",
                          "label",
                          "type",
                          "score",
                          "collection_pi"
                        ]
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "query": {
                          "type": "string"
                        },
                        "collections_searched": {
                          "type": "number"
                        },
                        "result_count": {
                          "type": "number"
                        }
                      },
                      "required": [
                        "query",
                        "collections_searched",
                        "result_count"
                      ]
                    }
                  },
                  "required": [
                    "results",
                    "metadata"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidationErrorResponse"
                },
                "example": {
                  "error": "Validation failed",
                  "details": {
                    "issues": [
                      {
                        "path": [
                          "properties",
                          "label"
                        ],
                        "message": "Required"
                      }
                    ]
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service Unavailable - External service not available",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Service unavailable",
                  "details": {
                    "service": "pinecone"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/chat": {
      "post": {
        "tags": [
          "Chat"
        ],
        "summary": "Send chat message",
        "description": "Send a message to the Arke chat agent and receive a streaming response.\n\nThe agent can execute Arke API operations on your behalf using the authenticated user's permissions.\n\n## Headers\n\n- `X-Chat-ID`: Optional. Specify to continue an existing chat session. If omitted, a new session is created.\n\n## Response Format\n\nThe response is a Server-Sent Events (SSE) stream in AI SDK v5 UIMessage format.\nStream chunks include text deltas, tool calls, and usage information.\n\n## Token Usage Tracking\n\nUsage information is included at the end of the stream in the format:\n```json\n{\"type\":\"message_delta\",\"delta\":{\"usage\":{\"input_tokens\":123,\"output_tokens\":456}}}\n```\n\n\n---\n**Permission:** `chat:send`  \n**Auth:** required",
        "x-arke-action": "chat:send",
        "x-arke-auth": "required",
        "x-arke-tier": "external",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SendChatRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Streaming SSE response",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "string",
                  "description": "Server-Sent Events stream in AI SDK v5 format"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          }
        }
      }
    },
    "/chat/sessions/{id}": {
      "get": {
        "tags": [
          "Chat"
        ],
        "summary": "Get chat session",
        "description": "Get information about a chat session including message history.\n\nSessions are publicly viewable for sharing purposes. Only the owner can send messages or delete the session.\n\n---\n**Permission:** `chat:view`  \n**Auth:** optional",
        "x-arke-action": "chat:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "responses": {
          "200": {
            "description": "Chat session info",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatSession"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Chat"
        ],
        "summary": "Delete chat session",
        "description": "Delete a chat session. Only the session owner can delete it.\n\n---\n**Permission:** `chat:delete`  \n**Auth:** required",
        "x-arke-action": "chat:delete",
        "x-arke-auth": "required",
        "x-arke-tier": "standard",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Session deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatSessionDeleteResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Missing or invalid authentication",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Unauthorized: Missing or invalid authentication token"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/entities/{id}/attestation": {
      "get": {
        "tags": [
          "Attestations"
        ],
        "summary": "Get latest attestation",
        "description": "Returns the Arweave attestation for the current (latest) version of an entity.\n\nReturns 202 Accepted if the attestation upload is still pending.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Attestation found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttestationResponse"
                }
              }
            }
          },
          "202": {
            "description": "Attestation pending",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttestationPendingResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/versions/{id}/{ver}/attestation": {
      "get": {
        "tags": [
          "Attestations"
        ],
        "summary": "Get version attestation",
        "description": "Returns the Arweave attestation for a specific version of an entity.\n\n---\n**Permission:** `entity:view`  \n**Auth:** optional",
        "x-arke-action": "entity:view",
        "x-arke-auth": "optional",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "pattern": "^(?:II[0-9A-HJKMNP-TV-Z]{24}|[FC][0-9A-HJKMNP-TV-Z]{25}|[0-9A-HJKMNP-TV-Z]{26})$",
              "description": "Entity ID (ULID format)",
              "example": "01KDETYWYWM0MJVKM8DK3AEXPY"
            },
            "required": true,
            "description": "Entity ID (ULID)",
            "name": "id",
            "in": "path"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "example": 1
            },
            "required": true,
            "description": "Version number",
            "name": "ver",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Attestation found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AttestationResponse"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Forbidden: You do not have permission to perform this action"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/attestations/head": {
      "get": {
        "tags": [
          "Attestations"
        ],
        "summary": "Get chain head",
        "description": "Returns the latest Arweave attestation transaction ID (network head).\n\n---\n**Permission:** `attestation:view`  \n**Auth:** none",
        "x-arke-action": "attestation:view",
        "x-arke-auth": "none",
        "x-arke-tier": "standard",
        "responses": {
          "200": {
            "description": "Chain head",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChainHeadResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    },
    "/attestations/verify/{tx}": {
      "get": {
        "tags": [
          "Attestations"
        ],
        "summary": "Verify attestation",
        "description": "Fetches an attestation from Arweave and verifies the CID matches the manifest content.\n\nThis is a public endpoint - anyone can verify attestations.\n\n---\n**Permission:** `attestation:verify`  \n**Auth:** none",
        "x-arke-action": "attestation:verify",
        "x-arke-auth": "none",
        "x-arke-tier": "standard",
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1,
              "example": "abc123xyz..."
            },
            "required": true,
            "description": "Arweave transaction ID",
            "name": "tx",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Verification result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/VerifyAttestationResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not Found - Resource does not exist",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Entity not found"
                }
              }
            }
          }
        }
      }
    }
  }
}